(this["webpackJsonpextrude-client"]=this["webpackJsonpextrude-client"]||[]).push([[0],{148:function(e,t,a){e.exports=a(222)},152:function(e,t,a){},182:function(e,t){},191:function(e,t,a){},192:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),s=a.n(o),c=(a(152),a(2)),i=a(13),l=a(1),u=a(79),p=a(8),h=a(3),d=a(15),y=a(12),m=a(16),v=a(80),f=a.n(v),g=function(){function e(){Object(y.a)(this,e)}return Object(m.a)(e,null,[{key:"randString",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"computeCompositeBoundingBox",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];e.walkNodes(t,(function(e){e.geometry&&((!a.excludedTypes||!a.excludedTypes.includes(e.userData.objectType))&&n.push(e))}));var r=new l.Box3;return n.forEach((function(e){e.updateMatrixWorld();var t=e.geometry.clone();t.applyMatrix(e.matrixWorld),t.computeBoundingBox(),r=r.union(t.boundingBox)})),r}},{key:"walkNodes",value:function(t,a){a(t);for(var n=0;n<t.children.length;n+=1)e.walkNodes(t.children[n],a)}},{key:"rand",value:function(e,t){return Math.random()*(t-e)+e}},{key:"vec3ToScreenPoint",value:function(e,t,a,n){var r=e.clone(),o=.5*a,s=.5*n;return r.project(t),r.x=r.x*o+o,r.y=-r.y*s+s,{x:r.x,y:r.y}}},{key:"exponentialEaseOut",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"centroid",value:function(e){var t=e.length;return e.reduce((function(e,a,n){return e.x+=a.x,e.y+=a.y,e.z+=a.z,n===t-1&&(e.x/=t,e.y/=t,e.z/=t),e}),new l.Vector3(0,0,0))}},{key:"pointsAreEqual3D",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))<a}},{key:"generateId",value:function(){return""+Math.round(1e6*Math.random())}}]),e}(),b=function(){function e(){Object(y.a)(this,e)}return Object(m.a)(e,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.randString(g.rand(3,12));return{name:e,id:g.generateId(),position:new l.Vector3(g.rand(-100,100),0,g.rand(-100,100)),visibleMessages:[],keyStates:{},target:new l.Vector3,skindex:5003*e.length%13}}},{key:"addMessage",value:function(e,t){return Object(d.a)({},e,{visibleMessages:[].concat(Object(i.a)(e.visibleMessages),[t])})}},{key:"removeOldestMessage",value:function(e){var t=e.visibleMessages.slice();return t.shift(),Object(d.a)({},e,{visibleMessages:t})}}]),e}(),E=a(227),O=function(){function e(t,a,n){Object(y.a)(this,e),this.socket=null,this.state={players:{}},this.messages=[],this.localPlayerId=t.id,this.updatePlayers=a,this.updateMessagesFunc=n,this.state.players[t.id]=t,this.connectToServer(t)}return Object(m.a)(e,[{key:"connectToServer",value:function(e){var t=this;this.socket=f()("https://nameless-depths-23573.herokuapp.com"),this.socket.emit("event",{type:"player_enter_request",player:e}),this.socket.on("event",(function(e){t.handleServerEvent(e)})),this.socket.on("disconnect",(function(a){t.handleServerEvent({type:"player_exit",player:e})})),this.socket.on("reconnect",(function(a){t.socket.emit("event",{type:"player_enter_request",player:e})})),this.sendMouseMove=Object(E.a)((function(){return t.socket.emit("event",{type:"player_target_change",playerId:t.localPlayerId,target:t.getLocalPlayer().target})}),1e3),this.periodicSyncInterval=setInterval((function(){t.socket.emit("event",{type:"player_sync",player:t.getLocalPlayer()})}),2e3)}},{key:"handleServerEvent",value:function(e){var t,a=this;switch(e.playerId&&(t=this.state.players[e.playerId]),e.type){case"player_enter":console.log("player_enter: ",e.player),this.state.players[e.player.id]=e.player,this.updatePlayers(this.getPlayersArray());break;case"player_exit":console.log("player_exit: ",e.player),this.state.players[e.player.id]&&e.player.id!==this.localPlayerId&&(delete this.state.players[e.player.id],this.updatePlayers(this.getPlayersArray()));break;case"full_state_request":this.socket.emit("event",{type:"full_state_response",state:this.state});break;case"full_state_update":this.state=e.state,this.updatePlayers(this.getPlayersArray());break;case"input_key_down":this.serverKeyDown(e);break;case"input_key_up":this.serverKeyUp(e);break;case"input_mouse_move":case"input_click":break;case"chat_message":if(e.playerId&&!this.state.players[e.playerId])break;var n=Object(d.a)({},e,{player:t}),r=5e3+1e3*Math.floor(n.message.length/100);this.state.players=Object(d.a)({},this.state.players,Object(h.a)({},e.playerId,b.addMessage(t,n))),setTimeout((function(){a.state.players=Object(d.a)({},a.state.players,Object(h.a)({},e.playerId,b.removeOldestMessage(a.state.players[e.playerId]))),a.updatePlayers(Object.values(a.state.players))}),r),this.messages=this.messages.concat(n),this.updateMessagesFunc(this.messages),this.updatePlayers(Object.values(this.state.players));break;case"player_target_change":if(e.playerId&&!this.state.players[e.playerId])break;this.state.players=Object(d.a)({},this.state.players,Object(h.a)({},e.playerId,Object(d.a)({},t,{target:e.target}))),this.updatePlayers(Object.values(this.state.players));break;case"player_sync":if(e.player.id===this.localPlayerId)break;this.state.players[e.player.id]=e.player,this.updatePlayers(Object.values(this.state.players));break;default:console.log("unrecognized server event: ",e)}}},{key:"getPlayersArray",value:function(){var e=this;return Object.keys(this.state.players).map((function(t){return e.state.players[t]}))}},{key:"serverKeyDown",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!0}}},{key:"serverKeyUp",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!1}}},{key:"localKeyDown",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!0,this.socket.emit("event",{type:"input_key_down",playerId:this.localPlayerId,key:a}))}},{key:"localKeyUp",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!1,this.socket.emit("event",{type:"input_key_up",playerId:this.localPlayerId,key:a}))}},{key:"localMouseMove",value:function(e){this.sendMouseMove()}},{key:"localClick",value:function(e){this.socket.emit("event",{type:"input_click",playerId:this.localPlayerId})}},{key:"sendChatMessage",value:function(e){this.socket.emit("event",{type:"chat_message",message:e,playerId:this.localPlayerId,time:new Date})}},{key:"getLocalPlayer",value:function(){return this.state.players[this.localPlayerId]}}]),e}();O.RECOGNIZED_KEYS=["a","w","s","d","f","e","q"," ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],O.KEY_TO_DIRECTION={a:"left",w:"up",s:"down",d:"right"};var k=O,w=function e(){Object(y.a)(this,e)};w.PLAYER_MODE_CREATE="create",w.PLAYER_MODE_EDIT="edit",w.PLAYER_MODE_DRAG="drag",w.PLAYER_MODE_OBJECT="object";var j=function(){function e(){Object(y.a)(this,e)}return Object(m.a)(e,null,[{key:"listenFor",value:function(t,a,n){a.includedMeshes=n,e.eventMaps[t]=a}},{key:"removeListener",value:function(t){delete e.eventMaps[t]}},{key:"eventOccurred",value:function(t,a){Object.values(e.eventMaps).forEach((function(e){(!e.includedMeshes||e.includedMeshes.includes(a.object.id))&&e[t]&&e[t](a)}))}}]),e}();j.MOUSE_MOVE="mouse_move",j.CLICK="click",j.POINTER_OUT="pointer_out",j.eventMaps={};var M=j,S=a(39),P=a(19),_=a(26);var x=a(51),I=a.n(x),D=a(86),C=a(54),R={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,crouch:!1,jump:!1,attack:!1},A=function(){function e(){Object(y.a)(this,e)}return Object(m.a)(e,null,[{key:"init",value:function(){var e=this,t={baseUrl:"models/ogro/",body:"ogro.md2",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png","sharokh.png"],weapons:[["weapon.md2","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:1e3,crouchSpeed:175};this.skinCount=t.skins.length,this.base=new C.a,this.base.scale=1,this.basePromise=new Promise((function(t,a){e.base.onLoadComplete=function(){e.base.enableShadows(!0),e.base.setSkin(2),t(e.base)}})),this.base.loadParts(t)}},{key:"customizeMovement",value:function(e){var t;e.updateMovementModel=(t=e,function(e){var a=t.controls;t.decceleration=1500,t.maxSpeed=t.walkSpeed,t.moveDirection||(t.moveDirection=new l.Vector3);var n=a.moveForward?1:0,r=a.moveBackward?-1:0,o=a.moveRight?-1:0,s=a.moveLeft?1:0,c=a.moveUp?1:0,i=a.moveDown?-1:0;t.impulseDirection=new l.Vector3(o+s,c+i,n+r),t.impulseDirection.normalize();var u=new l.Vector3(0,0,1).applyAxisAngle(new l.Vector3(0,1,0),t.bodyOrientation),p=new l.Vector3(t.target.x,t.target.y,t.target.z).clone().sub(t.root.position).normalize();p.y=0;var h=u.cross(p).y;if(t.bodyOrientation+=h*e*10,t.impulseDirection.applyAxisAngle(new l.Vector3(0,1,0),t.bodyOrientation),t.impulseDirection.length()>0&&t.moveDirection.copy(t.impulseDirection),Math.abs(h)>.2&&(t.speed=h*e*10,h<0?a.moveLeft=!0:a.moveRight=!0),t.impulseDirection.length()>0)t.speed=t.maxSpeed;else{var d=g.exponentialEaseOut(t.speed/t.maxSpeed);t.speed=l.MathUtils.clamp(t.speed-d*e*t.decceleration,0,t.maxSpeed)}var y=t.moveDirection.clone().multiplyScalar(t.speed*e/10);t.root.position.add(y),t.root.rotation.y=t.bodyOrientation})}},{key:"getModelInstance",value:function(){var e=Object(D.a)(I.a.mark((function e(){var t,a,n=arguments;return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.instanceIndex,this.instanceIndex=(this.instanceIndex+1)%this.skinCount,(a=new C.a).scale=1,a.controls=this.getControlsCopy(),a.id=Math.random(),this.customizeMovement(a),e.next=9,this.basePromise.then((function(e){return a.shareParts(e),a.enableShadows(!0),a.setSkin(t),a.target=new l.Vector3,a.setWeapon(0),a}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getControlsCopy",value:function(){var e={};return Object.keys(R).forEach((function(t){return e[t]=R[t]})),e}}]),e}();A.instanceIndex=2,A.init();var L=A;a(191);var z=function(e){var t=e.player,a=e.messages,o=e.mode,s=Object(n.useState)(null),i=Object(c.a)(s,2),u=i[0],h=i[1],d=Object(n.useState)(0),y=Object(c.a)(d,2),m=y[0],v=y[1],f=Object(n.useState)(null),b=Object(c.a)(f,2),E=b[0],O=b[1],k=Object(p.e)().size;return function(e,t){var a=Object(p.e)(),r=a.scene,o=a.size,s=a.camera,i=Object(n.useState)(null),u=Object(c.a)(i,2);u[0],u[1],Object(p.d)((function(){var a=e.map((function(e){return document.querySelector(e)})),n=[];t.forEach((function(e){r.traverse((function(t){t.userData.name===e&&n.push(t)}))})),a.length===n.length&&a.forEach((function(e,t){var a=n[t],r=new l.Vector3;a.getWorldPosition(r);var c=g.vec3ToScreenPoint(r,s,o.width,o.height);e.style.position="absolute",e.style.zIndex="10000",e.style.transform="translateX(-50%)",e.style.left=c.x+"px",e.style.top=c.y+"px"}))}))}(["#player-label-"+t.id],["md2-root-"+t.id]),Object(n.useEffect)((function(){var e=document.createElement("div");e.id="player-label-"+t.id,e.innerText=t.name,document.getElementsByClassName("App")[0].appendChild(e)}),[]),Object(n.useEffect)((function(){L.getModelInstance(t.skindex).then((function(e){var a=g.computeCompositeBoundingBox(e.root);e.root.userData.name="md2-root-"+t.id,v(a.getSize().y),h(e),e.root.position.set(t.position.x,e.root.position.y,t.position.z);var n=new _.a;n.setPositions([0,0,0,0,0,100]);var r=function(e){switch(e){case w.PLAYER_MODE_CREATE:return{color:6749969,size:2};case w.PLAYER_MODE_EDIT:return{color:13277,size:2};case w.PLAYER_MODE_DRAG:return{color:1179494,size:7};case w.PLAYER_MODE_OBJECT:return{color:8921736,size:2};default:console.error("unrecognized player mode",e)}}(o),s=new P.a({color:r.color,linewidth:r.size,vertexColors:!1,dashed:!1,resolution:new l.Vector2(k.width,k.height)}),c=new S.a(n,s);e.root.add(c),O(c)}))}),[o]),Object(p.d)((function(e,a){if(u){u.controls.moveForward=t.keyStates.w||t.keyStates.ArrowUp,u.controls.moveBackward=t.keyStates.s||t.keyStates.ArrowDown,u.controls.moveLeft=t.keyStates.a||t.keyStates.ArrowLeft,u.controls.moveRight=t.keyStates.d||t.keyStates.ArrowRight,u.controls.moveUp=t.keyStates.q,u.controls.moveDown=t.keyStates.e,u.controls.jump=t.keyStates[" "],u.controls.attack=t.keyStates.f,u.update(1.75*a),t.position.x=u.root.position.x,t.position.y=u.root.position.y,t.position.z=u.root.position.z,u.target=t.target;var n=new l.Vector3(t.position.x,t.position.y,t.position.z),r=new l.Vector3(u.target.x,u.target.y,u.target.z);r.sub(n),E.rotation.y=-u.bodyOrientation,E.geometry.setPositions([0,20,5,r.x,r.y,r.z]),E.geometry.needsUpdate=!0}})),r.a.createElement("mesh",null,u&&r.a.createElement(r.a.Fragment,null,r.a.createElement("primitive",{object:u.root,onClick:function(e){return console.log("click")}}),a.map((function(e,a){return r.a.createElement(p.b,{key:e.time,center:!0,position:[t.position.x,t.position.y+m/1.5,t.position.z]},r.a.createElement("div",{style:{transform:"translateY(".concat(2.1*-a,"rem)")},className:"speech-bubble"},e.message))}))))};Object(p.c)({LineMaterial:P.a,LineGeometry:_.a,Line2:S.a});var T=function(e){e.player;var t=e.finishStructureFunc,a=Object(n.useState)([]),o=Object(c.a)(a,2),s=o[0],u=o[1],d=Object(n.useState)(null),y=Object(c.a)(d,2),m=y[0],v=y[1],f=Object(n.useState)(!1),b=Object(c.a)(f,2),E=b[0],O=b[1],k=Object(p.e)().size;Object(n.useEffect)((function(){var e;return M.listenFor("partial_structure",(e={},Object(h.a)(e,M.MOUSE_MOVE,(function(e){if(s.length>0){var t=new l.Vector3(e.point.x,e.point.y+.1,e.point.z);v(t)}})),Object(h.a)(e,M.CLICK,(function(e){var a=new l.Vector3(e.point.x,e.point.y,e.point.z),n=!1;if(s.length>2){var r=a.clone().sub(s[0]);r.length()<20&&(a.add(r),n=!0)}if(a.y+=.1,u([].concat(Object(i.a)(s),[a])),n){var o=e.object.rotation.clone();o.x*=-1,o.y*=-1,o.z*=-1;var c=e.face.normal.clone().applyEuler(o),p=g.centroid(s),h={start:p,end:p.clone().addScaledVector(c,10)},d={id:g.generateId(),points:s,extrusionLine:h};t(d),u([]),O(!1),v(null)}})),e)),function(){M.removeListener("partial_structure")}}),[s]);var w=Object(p.f)((function(e){if(s.length<1||null===m)e.setPositions(new Float32Array(150));else{var a=m.clone();if(s.length>2){var n=s[0].clone().sub(m);n.length()<30?(a.add(n),O(!0)):O(!1),s[0].clone().sub(s[s.length-1]).length()<.1&&(t(s),u([]),O(!1),v(null))}var r=s.reduce((function(e,t){var a=t.x,n=t.y,r=t.z;return[].concat(Object(i.a)(e),[a,n,r])}),[],[]);for(r.push(a.x,a.y,a.z);r.length<150;)r.push(r[r.length-3],r[r.length-2],r[r.length-1]);r.length=Math.min(150,r.length),e.setPositions(r)}}),[s,m]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("line2",null,r.a.createElement("lineGeometry",{attach:"geometry",ref:w}),r.a.createElement("lineMaterial",{attach:"material",color:6749969,linewidth:10,resolution:[k.width,k.height]})),s.map((function(e,t){return r.a.createElement("mesh",{key:e.x+e.y+e.z+"",castShadow:!0,position:[e.x,e.y,e.z]},r.a.createElement("sphereGeometry",{attach:"geometry",args:[0===t&&E?30:7,32,32]}),r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0===t&&E?65280:1144576,clearcoat:!0,metalness:.25,clearcoatRoughness:.75,roughness:.1}))})))};var V=function(e){var t=e.points,a=e.extrusionLine,o=e.player,s=e.onPointerMove,i=e.onClick,u=e.onPointerOut,y=e.id,m=e.playerMode,v=e.setPlayerMode,f=Object(n.useState)(null),g=Object(c.a)(f,2),b=g[0],E=g[1],O=Object(n.useState)({steps:1,depth:4,bevelThickness:3,bevelSize:4,bevelSegments:4}),k=Object(c.a)(O,2),j=k[0],S=k[1],P=Object(n.useState)(!1),_=Object(c.a)(P,2),x=_[0],I=_[1],D=Object(n.useState)(null),C=Object(c.a)(D,2),R=C[0],A=C[1],L=Object(n.useState)(!1),z=Object(c.a)(L,2),T=(z[0],z[1],Object(n.useRef)());return Object(n.useEffect)((function(){E(new l.Shape(t.map((function(e){return new l.Vector2(e.x,e.z)}))))}),[t,a]),Object(p.d)((function(){if(m===w.PLAYER_MODE_DRAG&&null!==R){var e=(new l.Vector3).copy(o.position).sub(R),t=new l.Vector3(0,1,0),a=t.clone().multiplyScalar(t.dot(e)).length()+4;S(Object(d.a)({},j,{depth:a}))}})),Object(n.useEffect)((function(){var e;T.current&&M.listenFor("structure_"+y,(e={},Object(h.a)(e,M.MOUSE_MOVE,(function(e){var a=e.face.a;a>=0&&a<=6*(t.length-2)?I(!0):I(!1)})),Object(h.a)(e,M.CLICK,(function(e){m===w.PLAYER_MODE_EDIT&&x?(v(w.PLAYER_MODE_DRAG),A((new l.Vector3).copy(o.position))):m===w.PLAYER_MODE_DRAG&&(v(w.PLAYER_MODE_EDIT),A(null),I(!1))})),Object(h.a)(e,M.POINTER_OUT,(function(e){I(!1)})),e),[T.current.id])}),[T.current,x,m,y,v]),r.a.createElement(r.a.Fragment,null,b&&r.a.createElement("mesh",{ref:T,"rotation-x":Math.PI/2,"position-y":j.depth,castShadow:!0,receiveShadow:!0,onPointerMove:s,onClick:i,onPointerOut:u},r.a.createElement("extrudeBufferGeometry",{attach:"geometry",args:[b,j]}),r.a.createElement("meshPhysicalMaterial",{attach:"material",color:16777215,metalness:.9,roughness:0,clearcoat:!0,clearcoatRoughness:.25})),b&&x&&r.a.createElement("mesh",{"rotation-x":Math.PI/2,"position-y":j.depth+3.1},r.a.createElement("extrudeBufferGeometry",{attach:"geometry",args:[b,{depth:2,bevelSize:1,bevelThickness:1,bevelSegments:2}]}),m===w.PLAYER_MODE_EDIT&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:13277,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25}),m!==w.PLAYER_MODE_EDIT&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:4403,emissive:65280,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25})))},Y=(a(192),a(226));var B=function(e){var t=e.sendChatMessage,a=e.messages,o=e.hideChat,s=Object(n.useState)(""),i=Object(c.a)(s,2),l=i[0],u=i[1],p=Object(n.useRef)();return Object(n.useEffect)((function(){p.current.scrollTop=p.current.scrollHeight}),[a]),r.a.createElement("div",{className:"ChatWindow"},r.a.createElement("div",{className:"all-messages",ref:p},a.map((function(e){return r.a.createElement("div",{className:"chat-message",key:e.time},r.a.createElement("div",{className:"chat-message-name"},e.player.name,":"),r.a.createElement("div",{className:"chat-message-content"},e.message))}))),r.a.createElement(Y.c,{className:"your-message",placeholder:"your message...",large:!0,onKeyDown:function(e){13===e.which?(t(l),u("")):27===e.which&&o()},value:l,onChange:function(e){return u(e.target.value)},autoFocus:!0}))},N=a(91),U=a(90),K=a(92),F=a(93);a(219);Object(p.c)({EffectComposer:N.a,RenderPass:U.a,UnrealBloomPass:F.a,SSAOPass:K.a});var G=new u.a,W=new l.Vector3(0,100,100),q=new l.Vector3(0,0,0),J=new l.Vector3,Z=1,H=function(e){var t=e.playground,a=Object(p.e)().camera;return Object(p.d)((function(){G.update();var e=t.getLocalPlayer().position,n=t.getLocalPlayer().target,r=new l.Vector3(e.x,e.y,e.z),o=r.set(r.x,r.y+70,r.z),s=new l.Vector3(n.x,n.y,n.z).clone().sub(o).normalize().clone().multiplyScalar(-200*Z);s.z=Math.max(Math.abs(s.z),50)*Math.sign(s.z),s.y=Math.max(s.y,50),W.copy(r.clone().add(s)),q.copy(r);var c=l.MathUtils.clamp(a.position.clone().sub(W).length()/10,.1,4);a.position.copy(a.position.lerp(W,.005*c));var i=J.lerp(q,.05).clone();a.lookAt(i),a.updateProjectionMatrix(),J.copy(i)})),null};function X(e){var t=e.playground,a=e.setChatVisible,r=e.chatVisible,o=e.setPlayerMode,s=Object(p.e)().gl;return Object(n.useEffect)((function(){s.domElement.onclick=function(e){a(!1),t&&t.localClick(e)},window.onkeydown=function(e){"t"===e.key?(r||e.preventDefault(),a(!0)):27===e.which?a(!r):"j"===e.key?o(w.PLAYER_MODE_CREATE):"k"===e.key?o(w.PLAYER_MODE_EDIT):"l"===e.key&&o(w.PLAYER_MODE_OBJECT),t&&!r&&t.localKeyDown(e)},window.onkeyup=function(e){t&&t.localKeyUp(e)},s.domElement.onmousemove=function(e){t&&t.localMouseMove(e)},s.domElement.onwheel=function(e){e.preventDefault(),Z+=.01*e.deltaY,Z=Math.min(Math.max(.05,Z),3)}}),[s,t,r]),null}function Q(e){var t=e.ssao,a=e.bloom,o=Object(p.e)(),s=o.gl,c=o.scene,i=o.camera,l=o.size,u=Object(n.useRef)();return Object(n.useEffect)((function(){u.current.setSize(l.width,l.height)}),[l]),Object(p.d)((function(){return u.current.render()}),1),r.a.createElement("effectComposer",{ref:u,args:[s]},r.a.createElement("renderPass",{attachArray:"passes",args:[c,i]}),a&&r.a.createElement("unrealBloomPass",{attachArray:"passes",args:[void 0,1.5,.4,.6],bloomThreshold:1,bloomStrength:1,bloomRadius:0}),t&&r.a.createElement("sSAOPass",{attachArray:"passes",args:[c,i,l.width,l.height],kernelRadius:16,minDistance:.005,maxDistance:50}))}var $=function(e){var t=e.player,a=Object(n.useState)([]),o=Object(c.a)(a,2),s=o[0],u=o[1],h=Object(n.useState)([]),d=Object(c.a)(h,2),y=d[0],m=d[1],v=Object(n.useState)(null),f=Object(c.a)(v,2),g=f[0],b=f[1],E=Object(n.useState)(!1),O=Object(c.a)(E,2),j=O[0],S=O[1],P=Object(n.useState)([]),_=Object(c.a)(P,2),x=_[0],I=_[1],D=Object(n.useMemo)((function(){return(new l.TextureLoader).load("rust2.jpg")}),[]),C=Object(n.useState)(w.PLAYER_MODE_CREATE),R=Object(c.a)(C,2),A=R[0],L=R[1];Object(n.useEffect)((function(){b(new k(t,(function(e){return u(e)}),(function(e){return m(e)})))}),[t]);var Y=function(e){g.getLocalPlayer().target=e.point,t.target=e.point,M.eventOccurred(M.MOUSE_MOVE,e)},N=function(e){M.eventOccurred(M.CLICK,e)},U=function(e){M.eventOccurred(M.POINTER_OUT,e)};return Object(n.useEffect)((function(){console.log("MODE: ",A)}),[A]),r.a.createElement("div",{className:"main-canvas-container"},r.a.createElement(p.a,{style:{backgroundColor:"#789"},gl:{antialias:!1,alpha:!1},pixelRatio:window.devicePixelRatio,camera:{position:[0,10,10],near:1,far:4e3},shadowMap:!0,onCreated:function(e){var t=e.gl;t.toneMapping=l.Uncharted2ToneMapping,t.outputEncoding=l.sRGBEncoding,t.shadowMap.type=l.PCFSoftShadowMap,t.setClearColor(new l.Color("#667788"))}},r.a.createElement(Q,null),r.a.createElement(H,{playground:g}),r.a.createElement(X,{playground:g,setChatVisible:S,chatVisible:j,setPlayerMode:L}),r.a.createElement("fog",{attach:"fog",args:[6715272,500,1500]}),r.a.createElement("ambientLight",{args:[6710886]}),r.a.createElement("directionalLight",{args:[16777215,7],position:[0,6e3,3e3],"shadow-camera-left":-1e3,"shadow-camera-bottom":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-near":1,"shadow-camera-far":12e3,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,castShadow:!0}),s.map((function(e){return r.a.createElement(z,{key:e.id,player:e,mode:A,messages:e.visibleMessages})})),A===w.PLAYER_MODE_CREATE&&r.a.createElement(T,{player:t,finishStructureFunc:function(e){I([].concat(Object(i.a)(x),[e])),L(w.PLAYER_MODE_EDIT)}}),x.map((function(e){return r.a.createElement(V,{key:e.id,id:e.id,points:e.points,extrusionLine:e.extrusionLine,player:g.getLocalPlayer(),onPointerMove:Y,onClick:N,onPointerOut:U,playerMode:A,setPlayerMode:L})})),r.a.createElement("mesh",{receiveShadow:!0,"rotation-x":-Math.PI/2,onPointerMove:Y,onClick:N},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[16e3,16e3]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:3355443,roughness:.55,metalness:.8},r.a.createElement("primitive",{attach:"map",object:D,repeat:[64,64],wrapS:l.RepeatWrapping,wrapT:l.RepeatWrapping,encoding:l.sRGBEncoding})))),g&&j&&r.a.createElement(B,{sendChatMessage:g.sendChatMessage.bind(g),messages:y,hideChat:function(){return S(!1)}}))};a(220);var ee=function(e){var t=e.logIn,a=Object(n.useState)(""),o=Object(c.a)(a,2),s=o[0],i=o[1];return r.a.createElement("div",{className:"login-container bp3-light"},r.a.createElement(Y.b,{label:"Choose a name to use:"},r.a.createElement(Y.c,{autoFocus:!0,placeholder:"name...",large:!0,onChange:function(e){var t=e.target.value||"";i(t)},onKeyDown:function(e){return 13===e.which?t(b.create(s)):""}})),r.a.createElement(Y.a,{onClick:function(){t(b.create(s))}},"Join"))};a(221);var te=function(){var e=Object(n.useState)(!1),t=Object(c.a)(e,2),a=t[0],o=t[1],s=Object(n.useState)(null),i=Object(c.a)(s,2),l=i[0],u=i[1],p=function(e){u(e),o(!0)};return Object(n.useEffect)((function(){0}),[]),r.a.createElement("div",{className:"App bp3-dark"},l&&r.a.createElement($,{player:l}),r.a.createElement("div",{className:"screen-container"},!a&&r.a.createElement(ee,{logIn:p})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[148,1,2]]]);
//# sourceMappingURL=main.3fbdd2bf.chunk.js.map