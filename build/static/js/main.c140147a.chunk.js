(this["webpackJsonpextrude-client"]=this["webpackJsonpextrude-client"]||[]).push([[0],{148:function(e,t,a){e.exports=a(222)},152:function(e,t,a){},182:function(e,t){},191:function(e,t,a){},192:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(12),c=a.n(o),i=(a(152),a(3)),s=a(4),l=a(1),u=a(79),p=a(7),d=a(13),m=a(2),y=a(80),v=a.n(y),h=a(14),f=a(18),g=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"randString",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"computeCompositeBoundingBox",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];e.walkNodes(t,(function(e){e.geometry&&((!a.excludedTypes||!a.excludedTypes.includes(e.userData.objectType))&&n.push(e))}));var r=new l.Box3;return n.forEach((function(e){e.updateMatrixWorld();var t=e.geometry.clone();t.applyMatrix(e.matrixWorld),t.computeBoundingBox(),r=r.union(t.boundingBox)})),r}},{key:"walkNodes",value:function(t,a){a(t);for(var n=0;n<t.children.length;n+=1)e.walkNodes(t.children[n],a)}},{key:"rand",value:function(e,t){return Math.random()*(t-e)+e}},{key:"vec3ToScreenPoint",value:function(e,t,a,n){var r=e.clone(),o=.5*a,c=.5*n;return r.project(t),r.x=r.x*o+o,r.y=-r.y*c+c,{x:r.x,y:r.y}}},{key:"exponentialEaseOut",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"centroid",value:function(e){var t=e.length;return e.reduce((function(e,a,n){return e.x+=a.x,e.y+=a.y,e.z+=a.z,n===t-1&&(e.x/=t,e.y/=t,e.z/=t),e}),new l.Vector3(0,0,0))}},{key:"pointsAreEqual3D",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))<a}},{key:"generateId",value:function(){return""+Math.round(1e6*Math.random())}},{key:"step",value:function(e,t,a){return a<=e?0:a>=t?1:void 0}},{key:"smoothstep",value:function(e,t,a){var n=Math.max(0,Math.min(1,(a-e)/(t-e)));return n*n*(3-2*n)}},{key:"polygonArea",value:function(t){var a=0;t=t.map((function(e){return Array.isArray(e)?{x:e[0],y:e[1]}:e})),e.pointsAreEqual2D(t[0],t[t.length-1])||(t=t.concat(t[0]));for(var n=0;n<t.length-1;n+=1)a+=t[n].x*t[n+1].y-t[n].y*t[n+1].x;return Math.abs(a)/2}},{key:"pointsAreEqual2D",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;return void 0!==e.x?Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))<a:Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))<a}}]),e}(),b=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.randString(g.rand(3,12));return{name:e,id:g.generateId(),position:new l.Vector3(g.rand(-100,100),0,g.rand(-100,100)),visibleMessages:[],keyStates:{},target:new l.Vector3,skindex:5003*e.length%13}}},{key:"addMessage",value:function(e,t){return Object(s.a)({},e,{visibleMessages:[].concat(Object(d.a)(e.visibleMessages),[t])})}},{key:"removeOldestMessage",value:function(e){var t=e.visibleMessages.slice();return t.shift(),Object(s.a)({},e,{visibleMessages:t})}}]),e}(),O=a(227),E={players:{},structures:{},messages:[]},j=["a","w","s","d","f","e","q"," ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];function w(e,t){var a=t.playerId||(t.player?t.player.id:void 0),n=a?e.players[a]:void 0;switch(t.type){case"update_player":return console.assert(void 0!==a,"Undefined playerId; required for:",t),Object(s.a)({},e,{players:Object(s.a)({},e.players,Object(m.a)({},a,t.player))});case"remove_player":console.assert(void 0!==a,"Undefined playerId; required for:",t);var r=Object(s.a)({},e);return delete r.players[a],r;case"update_local_player":return console.assert(void 0!==a,"Undefined playerId; required for:",t),Object(s.a)({},e,{localPlayerId:a,players:Object(s.a)({},e.players,Object(m.a)({},a,t.player))});case"update_structure":return Object(s.a)({},e,{structures:Object(s.a)({},e.structures,Object(m.a)({},t.structure.id,t.structure))});case"replace_state":return t.state;case"update_player_key_state":return console.assert(void 0!==a,"Undefined playerId; required for:",t),Object(s.a)({},e,{players:Object(s.a)({},e.players,Object(m.a)({},a,Object(s.a)({},n,{keyStates:Object(s.a)({},n.keyStates,Object(m.a)({},t.key,t.state))})))});case"add_player_message":return console.assert(void 0!==a,"Undefined playerId; required for:",t),Object(s.a)({},e,{messages:[].concat(Object(d.a)(e.messages),[t.message]),players:Object(s.a)({},e.players,Object(m.a)({},a,Object(s.a)({},n,{visibleMessages:[].concat(Object(d.a)(n.visibleMessages),[t.message])})))});case"remove_oldest_player_message":if(console.assert(void 0!==a,"Undefined playerId; required for:",t),n){var o=n.visibleMessages.slice();return o.shift(),Object(s.a)({},e,{players:Object(s.a)({},e.players,Object(m.a)({},a,Object(s.a)({},n,{visibleMessages:o})))})}return e;case"update_player_target":return console.assert(void 0!==a,"Undefined playerId; required for:",t),Object(s.a)({},e,{players:Object(s.a)({},e.players,Object(m.a)({},a,Object(s.a)({},n,{target:t.target})))});default:return console.log("unrecognized action: ",t),e}}function k(e,t,a,n){var r=t.localPlayerId;r&&t.players[r];switch(e.type){case"player_enter":console.log("player_enter: ",e.player),a({type:"update_player",player:e.player});break;case"player_exit":console.log("player_exit: ",e.player),t.players[e.player.id]&&e.player.id!==r&&a({type:"remove_player",playerId:e.player.id});break;case"full_state_request":n.emit("event",{type:"full_state_response",state:t});break;case"full_state_update":a({type:"replace_state",state:Object(s.a)({},e.state,{localPlayerId:r})});break;case"input_key_down":if(e.playerId===r)return;a({type:"update_player_key_state",key:e.key,state:!0,playerId:e.playerId});break;case"input_key_up":if(e.playerId===r)return;a({type:"update_player_key_state",key:e.key,state:!1,playerId:e.playerId});break;case"chat_message":if(e.playerId&&!t.players[e.playerId])break;var o=5e3+1e3*Math.floor(e.message.length/100);a({type:"add_player_message",playerId:e.player.id,message:Object(s.a)({},e)}),setTimeout((function(){a({type:"remove_oldest_player_message",playerId:e.player.id})}),o);break;case"player_target_change":if(e.playerId&&!t.players[e.playerId]||e.playerId===t.localPlayerId)break;a({type:"update_player_target",playerId:e.playerId,target:e.target});break;case"update_player":if(e.player.id===r)break;a({type:"update_player",player:e.player});break;case"update_structure":if(e.playerId===r)break;a({type:"update_structure",structure:e.structure});break;default:console.log("unrecognized server event: ",e)}}var _=function(){var e=Object(n.useReducer)(w,E),t=Object(i.a)(e,2),a=t[0],r=t[1],o=Object(n.useRef)();Object(n.useEffect)((function(){if(o.current){var e=o.current,t=a.players[a.localPlayerId];!function(e,t,a){var n=t.localPlayerId,r=n?t.players[n]:void 0;e.removeListener("event"),e.removeListener("disconnect"),e.removeListener("reconnect"),e.on("event",(function(n){k(n,t,a,e)})),e.on("disconnect",(function(e){k({type:"player_exit",localPlayer:r})})),e.on("reconnect",(function(t){e.emit("event",{type:"player_enter_request",localPlayer:r})}))}(e,a,r);var n=setInterval((function(){o.current.emit("event",{type:"update_player",player:t})}),2e3);return function(){clearInterval(n)}}}),[a]);var c=Object(n.useMemo)((function(){return Object(O.a)((function(e){return o.current.emit("event",e,1e3)}))}),[]);return{execute:Object(n.useMemo)((function(){return function(e,t){!function(e,t,a,n,r){var o=t.current,c=a.localPlayerId,i=c?a.players[c]:void 0;switch(console.assert(t.current||"initialize"===e.type,"tried executing action before initialization: ",e.type),e.type){case"initialize":t.current=v()("https://nameless-depths-23573.herokuapp.com"),n({type:"update_local_player",player:e.player}),t.current.emit("event",{type:"player_enter_request",player:e.player});break;case"key_down":if(!j.includes(e.key))return;n({type:"update_player_key_state",key:e.key,state:!0,playerId:c}),o.emit("event",{type:"input_key_down",playerId:c,key:e.key});break;case"key_up":if(!j.includes(e.key))return;n({type:"update_player_key_state",key:e.key,state:!1,playerId:c}),o.emit("event",{type:"input_key_up",playerId:c,key:e.key});break;case"update_player_target":n({type:"update_player_target",playerId:c,target:e.target}),r({type:"player_target_change",playerId:c,target:e.target});break;case"send_chat_message":o.emit("event",{type:"chat_message",message:e.message,player:i,time:new Date});break;case"update_structure":n(e),o.emit("event",Object(s.a)({},e,{playerId:c}));break;case"update_player":n(e),o.emit("event",e);break;default:new Error("unrecognized action:",e)}}(Object(s.a)({type:e},t),o,a,r,c)}}),[r,a,c]),state:a}},M=function e(){Object(h.a)(this,e)};M.MODE_DEFAULT="default",M.MODE_MENU="menu",M.MODE_EXTRUDE="extrude",M.MODE_MATERIALS="materials",M.STRUCTURE_MODE_EXTRUDE="structure_extrude";var x=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"listenFor",value:function(t,a,n){a.includedMeshes=n,e.eventMaps[t]=a}},{key:"removeListener",value:function(t){delete e.eventMaps[t]}},{key:"eventOccurred",value:function(t,a){Object.values(e.eventMaps).forEach((function(e){(!e.includedMeshes||e.includedMeshes.includes(a.object.id))&&e[t]&&e[t](a)}))}}]),e}();x.MOUSE_MOVE="mouse_move",x.CLICK="click",x.POINTER_OUT="pointer_out",x.POINTER_OVER="pointer_over",x.eventMaps={};var S=x,D=a(39),I=a(19),z=a(26);var P=a(51),T=a.n(P),V=a(86),U=a(54),C={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,crouch:!1,jump:!1,attack:!1},R=function(){function e(){Object(h.a)(this,e)}return Object(f.a)(e,null,[{key:"init",value:function(){var e=this,t={baseUrl:"models/ogro/",body:"ogro.md2",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png","sharokh.png"],weapons:[["weapon.md2","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:1e3,crouchSpeed:175};this.skinCount=t.skins.length,this.base=new U.a,this.base.scale=1,this.basePromise=new Promise((function(t,a){e.base.onLoadComplete=function(){e.base.enableShadows(!0),e.base.setSkin(2),t(e.base)}})),this.base.loadParts(t)}},{key:"customizeMovement",value:function(e){var t;e.updateMovementModel=(t=e,function(e){var a=t.controls;t.decceleration=1500,t.maxSpeed=t.walkSpeed,void 0===t.t&&(t.t=100),t.moveDirection||(t.moveDirection=new l.Vector3);var n=a.moveForward?1:0,r=a.moveBackward?-1:0,o=a.moveRight?-1:0,c=a.moveLeft?1:0,i=a.moveUp?1:0,s=a.moveDown?-1:0;t.impulseDirection=new l.Vector3(o+c,i+s,n+r),t.impulseDirection.normalize();var u=new l.Vector3(0,0,1).applyAxisAngle(new l.Vector3(0,1,0),t.bodyOrientation),p=new l.Vector3(t.target.x,t.target.y,t.target.z).clone().sub(t.root.position).normalize();p.y=0;var d=u.cross(p).y;if(t.bodyOrientation+=d*e*10,t.impulseDirection.applyAxisAngle(new l.Vector3(0,1,0),t.bodyOrientation),t.impulseDirection.length()>0&&t.moveDirection.copy(t.impulseDirection),Math.abs(d)>.2&&(t.speed=d*e*10,d<0?a.moveLeft=!0:a.moveRight=!0),t.impulseDirection.length()>0)t.speed=t.maxSpeed;else{var m=g.exponentialEaseOut(t.speed/t.maxSpeed);t.speed=l.MathUtils.clamp(t.speed-m*e*t.decceleration,0,t.maxSpeed)}var y=t.moveDirection.clone().multiplyScalar(t.speed*e/10);t.root.position.add(y),t.root.rotation.y=t.bodyOrientation})}},{key:"getModelInstance",value:function(){var e=Object(V.a)(T.a.mark((function e(){var t,a,n=arguments;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.instanceIndex,this.instanceIndex=(this.instanceIndex+1)%this.skinCount,(a=new U.a).scale=1,a.controls=this.getControlsCopy(),a.id=Math.random(),this.customizeMovement(a),e.next=9,this.basePromise.then((function(e){return a.shareParts(e),a.enableShadows(!0),a.setSkin(t),a.target=new l.Vector3,a.setWeapon(0),a}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getControlsCopy",value:function(){var e={};return Object.keys(C).forEach((function(t){return e[t]=C[t]})),e}}]),e}();R.instanceIndex=2,R.init();var A=R;a(191);var L=function(e){var t=e.player,a=e.isLocalPlayer,o=e.t,c=Object(n.useState)(null),s=Object(i.a)(c,2),u=s[0],d=s[1],m=Object(n.useState)(0),y=Object(i.a)(m,2),v=y[0],h=y[1],f=Object(n.useState)(null),b=Object(i.a)(f,2),O=b[0],E=b[1],j=Object(p.e)().size;return function(e,t){var a=Object(p.e)(),n=a.scene,r=a.size,o=a.camera;Object(p.d)((function(){var a=e.map((function(e){return document.querySelector(e)})),c=[];t.forEach((function(e){n.traverse((function(t){t.userData.name===e&&c.push(t)}))})),a.length===c.length&&a.forEach((function(e,t){var a=c[t],n=new l.Vector3;a.getWorldPosition(n);var i=g.vec3ToScreenPoint(n,o,r.width,r.height);e.style.position="absolute",e.style.zIndex="10000",e.style.transform="translateX(-50%)",e.style.left=i.x+"px",e.style.top=i.y+"px"}))}))}(["#player-label-"+t.id],["md2-root-"+t.id]),Object(n.useEffect)((function(){var e=document.createElement("div");e.id="player-label-"+t.id,e.className="scene-label",e.innerText=t.name;var a=document.getElementsByClassName("App")[0];return a.appendChild(e),function(){return a.removeChild(e)}}),[t.id,t.name]),Object(n.useEffect)((function(){if(u){if(-1===o||u.root.position.y>25)return;u.t=o,a||u.root.position.copy(t.position)}}),[o,u,t]),Object(n.useEffect)((function(){A.getModelInstance(t.skindex).then((function(e){var a=g.computeCompositeBoundingBox(e.root);e.root.userData.name="md2-root-"+t.id,h(a.getSize().y),d(e),e.root.position.set(t.position.x,e.root.position.y,t.position.z);var n=new z.a;n.setPositions([0,0,0,0,0,100]);var r=new I.a({color:6749969,linewidth:2,vertexColors:!1,dashed:!1,resolution:new l.Vector2(j.width,j.height)}),o=new D.a(n,r);e.root.add(o),E(o)}))}),[]),Object(p.d)((function(e,a){if(u){u.controls.moveForward=t.keyStates.w||t.keyStates.ArrowUp,u.controls.moveBackward=t.keyStates.s||t.keyStates.ArrowDown,u.controls.moveLeft=t.keyStates.a||t.keyStates.ArrowLeft,u.controls.moveRight=t.keyStates.d||t.keyStates.ArrowRight,u.controls.moveUp=t.keyStates.q,u.controls.moveDown=t.keyStates.e,u.controls.jump=t.keyStates[" "],u.controls.attack=t.keyStates.f,u.update(1.75*a),u.t+=1.75*a,u.root.position.y=Math.max(24.25,24.25+-18.369*Math.pow(u.t,2)*15+17.209*u.t*15),t.position.x=u.root.position.x,t.position.y=u.root.position.y,t.position.z=u.root.position.z,u.target=t.target;var n=new l.Vector3(t.position.x,t.position.y,t.position.z),r=new l.Vector3(u.target.x,u.target.y,u.target.z);r.sub(n),O.rotation.y=-u.bodyOrientation,O.geometry.setPositions([0,20,5,r.x,r.y,r.z]),O.geometry.needsUpdate=!0}})),r.a.createElement("mesh",null,u&&r.a.createElement(r.a.Fragment,null,r.a.createElement("primitive",{object:u.root,onClick:function(e){return console.log("click")}}),t.visibleMessages.map((function(e,a){return r.a.createElement(p.b,{key:e.time,center:!0,position:[t.position.x,t.position.y+v/1.5,t.position.z]},r.a.createElement("div",{style:{transform:"translateY(".concat(2.1*-a,"rem)")},className:"speech-bubble"},e.message))}))))};var F=function(e){var t=e.position,a=e.orientation,o=e.target,c=e.mouse,i=e.cellSize,s=Object(p.e)().size,u=Object(n.useRef)();Object(n.useEffect)((function(){if(u.current){var e=t.clone().addScaledVector(a,5);u.current.lookAt(e)}}),[t,a]);var d=Object(n.useMemo)((function(){return{vTarget:{value:o},planeSize:{value:new l.Vector2(1e4,1e4)},mouse:{value:c},cellSize:{value:i}}}),[]);return Object(p.d)((function(){d.mouse.value.x=c.x,d.mouse.value.y=s.height-c.y,d.cellSize.value=i,d.vTarget.value=o})),r.a.createElement("mesh",{ref:u,position:t},r.a.createElement("planeGeometry",{attach:"geometry",args:[1e4,1e4]}),r.a.createElement("shaderMaterial",{attach:"material",extensions:{derivatives:!0},blending:l.AdditiveBlending,depthTest:!1,depthWrite:!0,transparent:!0,side:l.DoubleSide,uniforms:d,fragmentShader:"\n        varying vec3 norm;\n        varying vec2 pos;\n        varying vec3 posW;\n        varying vec2 vUv;\n        varying vec3 target;\n        varying vec2 px;\n\n        uniform vec2 planeSize;\n        uniform vec2 mouse;\n        uniform float cellSize;\n\n        float gridValue(vec2 coord){\n            vec2 nCoord = (coord / cellSize);\n            vec2 grid = abs(fract(nCoord) - 0.5) / fwidth(nCoord*2.95);\n            float line = min(grid.x, grid.y);\n            return 1.0 - min(line, 1.0);\n        }\n\n        float gridVal2(vec3 coord){\n            vec3 nCoord = (coord / cellSize) - cellSize/4.;\n            vec3 grid = abs(fract(nCoord) - 0.5);\n            float line = max(max(grid.x, grid.y), grid.z);\n            return 1. - step(.1, line);\n        }\n\n        void main() {\n            vec4 blue = vec4(0., 0., 1.5, 0.5);\n            float blendFactor = min(2.3 / length(fwidth(vUv)), 1.0);\n            vec2 shiftedPos = pos + cellSize/2.;\n            float gridVal = gridValue(shiftedPos);\n            \n            // go from screen coords to [0, 1]\n            vec2 mouseOffset = (gl_FragCoord.xy - mouse) / planeSize.x;\n\n            // float mouseToPoint = 1.;\n            // float mouseToEdge = gridVal2(target);\n            // float pointToEdge = gridVal2(posW); //1. - step(.55, length(fract(posW / cellSize)));\n            float on = 0.; //min(min(pointToEdge, mouseToEdge), mouseToPoint);\n\n            float spotlight = (1. - smoothstep(0.04, 0.065, length(vUv - 0.5 + mouseOffset)));\n\n            gl_FragColor = blue * gridVal * spotlight * blendFactor + vec4(1., 0., 0., 0.85)*on;\n        }\n    ",vertexShader:"\n        varying vec3 norm;\n        varying vec2 pos;\n        varying vec3 posW;\n        varying vec2 vUv;\n        varying vec3 target;\n        varying vec2 px;\n\n        uniform vec2 planeSize;\n        uniform vec2 mouse;\n        uniform vec3 vTarget;\n\n        void main() {\n            norm = normalize(normalMatrix * normal);\n            pos = ((uv - 0.5) * planeSize);\n            posW = position;\n            target = vTarget;\n            vUv = uv;\n            px = (2.0*uv - 1.0)/2.0 * planeSize;\n\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    "}))},N=new l.Vector2,q={};Object(p.c)({LineMaterial:I.a,LineGeometry:z.a,Line2:D.a});var B=function(e){var t=e.player,a=e.finishStructureFunc,o=Object(n.useState)([]),c=Object(i.a)(o,2),u=c[0],y=c[1],v=Object(n.useState)(null),h=Object(i.a)(v,2),f=h[0],b=h[1],O=Object(n.useState)(!1),E=Object(i.a)(O,2),j=E[0],w=E[1],k=Object(n.useState)({position:new l.Vector3,target:new l.Vector2,orientation:new l.Vector3,mouse:new l.Vector2}),_=Object(i.a)(k,2),M=_[0],x=_[1],D=Object(p.e)().size,I=u.length>0;Object(n.useEffect)((function(){var e;return S.listenFor("partial_structure",(e={},Object(m.a)(e,S.MOUSE_MOVE,(function(e){if(I){var t=new l.Vector3(e.point.x,e.point.y,e.point.z);b(t);var a=e.object.rotation.clone(),n=e.face.normal.clone().applyEuler(a),r=["a","b","c"].map((function(t){var a=e.face[t],n=e.object.geometry.vertices,r=e.object.geometry.vertices||e.object.geometry.attributes.position.array;return n?r[a].clone():new l.Vector3(r[3*a],r[3*a+1],r[3*a+2])})).map((function(e){return e.applyEuler(a)})),o=[r[1].clone().sub(r[0]),r[2].clone().sub(r[1]),r[0].clone().sub(r[2])];o.sort((function(e,t){return t.length()-e.length()})),o.pop();var c=(o[0].length()+o[1].length())/2,i=o[0].clone().normalize(),p=o[1].clone().normalize(),d=i.clone().multiplyScalar(i.dot(e.point.clone().sub(u[0]))),m=p.clone().multiplyScalar(p.dot(e.point.clone().sub(u[0]))),y=new l.Vector2(d.length(),m.length());console.log("target2d",y),u.length>0&&x(Object(s.a)({},M,{position:u[0].clone(),orientation:n,target:e.point.clone(),mouse:new l.Vector2(N.x,N.y),cellSize:Math.min(c/5,50)}))}})),Object(m.a)(e,S.CLICK,(function(e){if(!e.shiftKey){var n=new l.Vector3(e.point.x,e.point.y,e.point.z),r=!1;if(u.length>2){var o=n.clone().sub(u[0]);o.length()<22&&(n.add(o),r=!0)}if(y([].concat(Object(d.a)(u),[n])),r){var c=e.object.rotation.clone(),i=e.face.normal.clone().applyEuler(c),s={id:g.generateId(),owner:t.id,points:u,normal:i,extrusionParams:{depth:4,row:0,theta:0,bevelThickness:3,bevelSize:4,bevelSegments:4,steps:1}};a(s),y([]),w(!1),b(null)}}})),e)),function(){S.removeListener("partial_structure")}}),[u]);var z=Object(p.f)((function(e){if(u.length<1||null===f)e.setPositions(new Float32Array(150));else{var t=f.clone();if(u.length>2){var n=u[0].clone().sub(f);n.length()<22?(t.add(n),w(!0)):w(!1),u[0].clone().sub(u[u.length-1]).length()<.1&&(a(u),y([]),w(!1),b(null))}var r=u.reduce((function(e,t){var a=t.x,n=t.y,r=t.z;return[].concat(Object(d.a)(e),[a,n,r])}),[],[]);for(r.push(t.x,t.y,t.z);r.length<150;)r.push(r[r.length-3],r[r.length-2],r[r.length-1]);r.length=Math.min(150,r.length),e.setPositions(r)}}),[u,f]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("line2",null,r.a.createElement("lineGeometry",{attach:"geometry",ref:z}),r.a.createElement("lineMaterial",{attach:"material",color:6749969,linewidth:10,resolution:[D.width,D.height]})),u.map((function(e,t){return r.a.createElement("mesh",{key:e.x+e.y+e.z+"",castShadow:!0,position:[e.x,e.y,e.z]},r.a.createElement("sphereGeometry",{attach:"geometry",args:[0===t&&j?22:7,32,32]}),r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0===t&&j?65280:1144576,clearcoat:!0,metalness:.25,clearcoatRoughness:.75,roughness:.1}))})),I&&r.a.createElement(F,{position:M.position,orientation:M.orientation,target:M.target,mouse:M.mouse,cellSize:M.cellSize}))};var W=function(e){var t=e.structure,a=e.updateStructure,o=e.active,c=(e.player,e.onPointerMove),s=e.onClick,u=e.onPointerOut,p=e.mode,d=e.setMode,y=(e.shiftDown,e.mouseTravel,Object(n.useState)(null)),v=Object(i.a)(y,2),h=v[0],f=v[1],b=Object(n.useState)(!1),O=Object(i.a)(b,2),E=O[0],j=O[1],w=Object(n.useState)(null),k=Object(i.a)(w,2),_=(k[0],k[1],Object(n.useState)(new l.Vector3)),x=Object(i.a)(_,2),D=x[0],I=x[1],z=Object(n.useRef)();Object(n.useEffect)((function(){var e=g.centroid(t.points),a=(new l.Vector3).copy(t.normal),n=new l.Vector3(0,0,1),r=new l.Quaternion;r.setFromUnitVectors(a,n);var o=t.points.map((function(t){return new l.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)})).map((function(e){return e.clone().applyQuaternion(r)}));f(new l.Shape(o.map((function(e){return new l.Vector2(e.x,e.y)})))),I(e)}),[t.points]),Object(n.useEffect)((function(){var e,n=function(e){if(e.shiftKey){var a=e.face.a;a>=0&&a<=6*(t.points.length-2)?j(!0):j(!1)}else j(!1)};z.current&&S.listenFor("structure_"+t.id,(e={},Object(m.a)(e,S.MOUSE_MOVE,n),Object(m.a)(e,S.CLICK,(function(e){p===M.MODE_DEFAULT?e.shiftKey&&d(M.MODE_EXTRUDE,t.id):o&&p===M.MODE_EXTRUDE&&a(t)})),Object(m.a)(e,S.POINTER_OUT,(function(e){j(!1)})),Object(m.a)(e,S.POINTER_OVER,n),e),[z.current.id])}),[z.current,E,t,p,o]);var P=o&&p===M.MODE_EXTRUDE,T=h&&E&&p===M.MODE_DEFAULT;return r.a.createElement(r.a.Fragment,null,h&&r.a.createElement("mesh",{ref:z,quaternion:V(t.normal),position:D,castShadow:!0,receiveShadow:!0,onPointerMove:c,onClick:s,onPointerOut:u},r.a.createElement("extrudeGeometry",{attach:"geometry",args:[h,t.extrusionParams]}),P&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:65280,emissiveIntensity:.7,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25}),!P&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emmissive:65280,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25})),h&&p!==M.MODE_EXTRUDE&&r.a.createElement("mesh",{quaternion:V(t.normal),position:function(e,t,a){return e.clone().addScaledVector(t,a+1.5)}(D,t.normal,t.extrusionParams.depth)},r.a.createElement("extrudeBufferGeometry",{attach:"geometry",args:[h,{depth:1,bevelSize:1,bevelThickness:1,bevelSegments:2}]}),T&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:13277,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25}),!T&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:13277,emissiveIntensity:.05,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25})));function V(e){var t=new l.Quaternion;return t.setFromUnitVectors(new l.Vector3(0,0,1),e),t}},X=(a(192),a(226));var G=function(e){var t=e.sendChatMessage,a=e.localPlayer,o=(e.players,e.messages),c=e.hideChat,s=Object(n.useState)(""),l=Object(i.a)(s,2),u=l[0],p=l[1],d=Object(n.useRef)();return Object(n.useEffect)((function(){d.current.scrollTop=d.current.scrollHeight}),[o]),r.a.createElement("div",{className:"ChatWindow"},r.a.createElement("div",{className:"all-messages",ref:d},o.map((function(e){return r.a.createElement("div",{className:"chat-message",key:e.time},r.a.createElement("div",{className:"chat-message-name"},e.player.name,":"),r.a.createElement("div",{className:"chat-message-content"},e.message))}))),r.a.createElement(X.c,{className:"your-message",placeholder:"your message...",large:!0,onKeyDown:function(e){13===e.which?(t({message:u,playerId:a.id,time:new Date}),p("")):27===e.which&&c(),e.stopPropagation()},value:u,onChange:function(e){return p(e.target.value)},autoFocus:!0}))},K=a(91),Y=a(90),J=a(92),Q=a(93);a(219);Object(p.c)({EffectComposer:K.a,RenderPass:Y.a,UnrealBloomPass:Q.a,SSAOPass:J.a});var H=new u.a,Z=new l.Vector3(0,100,100),$=new l.Vector3(0,0,0),ee=new l.Vector3,te=1,ae=function(e){var t=e.localPlayer,a=e.mode,n=Object(p.e)(),r=n.camera;n.scene;return Object(p.d)((function(){if(H.update(),a===M.MODE_DEFAULT){var e=t.position,n=t.target,o=new l.Vector3(e.x,e.y,e.z),c=o.set(o.x,o.y+70,o.z),i=new l.Vector3(n.x,n.y,n.z).clone().sub(c).normalize().clone().multiplyScalar(-200*te);i.z=Math.max(Math.abs(i.z),50)*Math.sign(i.z),i.y=Math.max(i.y,50),Z.copy(o.clone().add(i)),$.copy(o);var s=l.MathUtils.clamp(r.position.clone().sub(Z).length()/10,.1,4);r.position.copy(r.position.lerp(Z,.005*s));var u=ee.lerp($,.05).clone();r.lookAt(u),r.updateProjectionMatrix()}})),null};function ne(e){var t=e.ssao,a=e.bloom,o=Object(p.e)(),c=o.gl,i=o.scene,s=o.camera,l=o.size,u=Object(n.useRef)();return Object(n.useEffect)((function(){u.current.setSize(l.width,l.height)}),[l]),Object(p.d)((function(){return u.current.render()}),1),r.a.createElement("effectComposer",{ref:u,args:[c]},r.a.createElement("renderPass",{attachArray:"passes",args:[i,s]}),a&&r.a.createElement("unrealBloomPass",{attachArray:"passes",args:[void 0,1.5,.4,.6],bloomThreshold:1,bloomStrength:1,bloomRadius:0}),t&&r.a.createElement("sSAOPass",{attachArray:"passes",args:[i,s,l.width,l.height],kernelRadius:16,minDistance:.005,maxDistance:50}))}function re(e){var t=e.mode,a=e.setMode,r=e.execute,o=e.structures,c=e.chatVisible,i=e.setChatVisible,l=e.setT,u=e.setShiftDown,d=e.activeObjectId,m=(e.setActiveObjectId,e.mouseTravel),y=e.setMouseTravel,v=Object(p.e)(),h=v.gl;v.size;return Object(n.useEffect)((function(){h.domElement.onclick=function(e){switch(t){case M.MODE_DEFAULT:i(!1);break;case M.MODE_EXTRUDE:a(M.MODE_DEFAULT)}},window.onkeydown=function(e){9===e.which&&(e.preventDefault(),i(!c)),q[e.key]=!0,r("key_down",Object(s.a)({},e,{which:e.which,key:e.key})),"Shift"===e.key&&u(!0)," "===e.key&&(l(0),l(-1))},window.onkeyup=function(e){q[e.key]=!0,"Shift"===e.key&&u(!1),r("key_up",Object(s.a)({},e,{which:e.which,key:e.key}))},h.domElement.onmousemove=function(e){switch(N.x=e.clientX,N.y=e.clientY,t){case M.MODE_DEFAULT:break;case M.MODE_EXTRUDE:y({x:m.x+e.movementX,y:m.y+e.movementY})}},h.domElement.onwheel=function(e){switch(t){case M.MODE_DEFAULT:e.preventDefault(),te+=.01*e.deltaY,te=Math.min(Math.max(.05,te),3);break;case M.MODE_EXTRUDE:var a=o[d],n=Math.max(0,a.extrusionParams.depth+e.deltaY),c=Object(s.a)({},a,{extrusionParams:Object(s.a)({},a.extrusionParams,{depth:n})});r("update_structure",{structure:c})}}}),[h,c,t,d,o,m]),null}var oe=function(e){var t=e.playerInfo,a=Object(n.useState)(!1),o=Object(i.a)(a,2),c=o[0],s=o[1],u=Object(n.useState)(null),d=Object(i.a)(u,2),m=d[0],y=d[1],v=Object(n.useState)({x:0,y:0}),h=Object(i.a)(v,2),f=h[0],g=h[1],b=Object(n.useState)(100),O=Object(i.a)(b,2),E=O[0],j=O[1],w=Object(n.useMemo)((function(){return(new l.TextureLoader).load("rust2.jpg")}),[]),k=Object(n.useState)(M.MODE_DEFAULT),x=Object(i.a)(k,2),D=x[0],I=x[1],z=Object(n.useState)(!1),P=Object(i.a)(z,2),T=P[0],V=P[1],U=_(),C=U.execute,R=U.state,A=R.players[R.localPlayerId];Object(n.useEffect)((function(){C("initialize",{player:t}),console.log("executed initialize!")}),[t]);var F=function(e){e.stopPropagation(),C("update_player_target",{target:e.point,playerId:A.id}),S.eventOccurred(S.MOUSE_MOVE,e)},N=function(e){e.stopPropagation(),S.eventOccurred(S.CLICK,e)},q=function(e){S.eventOccurred(S.POINTER_OUT,e)},X=function(e){S.eventOccurred(S.POINTER_OVER,e)},K=function(e){console.log("calling update structure",e),C("update_structure",{structure:e}),y(null),g({x:0,y:0}),I(M.MODE_DEFAULT)};return r.a.createElement("div",{className:"main-canvas-container"},r.a.createElement(p.a,{style:{backgroundColor:"#789"},gl:{antialias:!1,alpha:!1},pixelRatio:window.devicePixelRatio,camera:{position:[0,10,10],near:1,far:4e3},shadowMap:!0,onCreated:function(e){var t=e.gl;t.toneMapping=l.Uncharted2ToneMapping,t.outputEncoding=l.sRGBEncoding,t.shadowMap.type=l.PCFSoftShadowMap,t.setClearColor(new l.Color("#667788"))}},r.a.createElement(ne,null),r.a.createElement(re,{mode:D,setMode:I,execute:C,structures:R.structures,chatVisible:c,setChatVisible:s,activeObjectId:m,setActiveObjectId:y,mouseTravel:f,setMouseTravel:g,setT:j,setShiftDown:V}),r.a.createElement(ae,{localPlayer:A,mode:D}),r.a.createElement("fog",{attach:"fog",args:[6715272,500,1500]}),r.a.createElement("ambientLight",{args:[6710886]}),r.a.createElement("directionalLight",{args:[16777215,7],position:[0,6e3,3e3],"shadow-camera-left":-1e3,"shadow-camera-bottom":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-near":1,"shadow-camera-far":12e3,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,castShadow:!0}),Object.values(R.players).map((function(e){return r.a.createElement(L,{key:e.id,t:E,player:e,isLocalPlayer:e.id===A.id})})),D===M.MODE_DEFAULT&&r.a.createElement(B,{player:A,finishStructureFunc:function(e){C("update_structure",{structure:e}),I(M.MODE_EXTRUDE),y(e.id)}}),Object.values(R.structures).map((function(e){return r.a.createElement(W,{key:e.id,structure:e,updateStructure:K,player:A,onPointerMove:F,onClick:N,onPointerOut:q,onPointerOver:X,mode:D,active:m===e.id,shiftDown:T,setMode:function(e,t){I(e),t&&y(t)},mouseTravel:f})})),r.a.createElement("mesh",{receiveShadow:!0,"rotation-x":-Math.PI/2,onPointerMove:F,onClick:N},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[16e3,16e3]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:3355443,roughness:.55,metalness:.8},r.a.createElement("primitive",{attach:"map",object:w,repeat:[64,64],wrapS:l.RepeatWrapping,wrapT:l.RepeatWrapping,encoding:l.sRGBEncoding})))),c&&r.a.createElement(G,{players:R.players,sendChatMessage:function(e){C("send_chat_message",e)},localPlayer:A,messages:R.messages,hideChat:function(){return s(!1)}}))};a(220);var ce=function(e){var t=e.logIn,a=Object(n.useState)(""),o=Object(i.a)(a,2),c=o[0],s=o[1];return r.a.createElement("div",{className:"login-container bp3-light"},r.a.createElement(X.b,{label:"Choose a name to use:"},r.a.createElement(X.c,{autoFocus:!0,placeholder:"name...",large:!0,onChange:function(e){var t=e.target.value||"";s(t)},onKeyDown:function(e){return 13===e.which?t(b.create(c)):""}})),r.a.createElement(X.a,{onClick:function(){t(b.create(c))}},"Join"))};a(221);var ie=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],o=t[1],c=Object(n.useState)(null),s=Object(i.a)(c,2),l=s[0],u=s[1],p=function(e){u(e),o(!0)};return Object(n.useEffect)((function(){p(b.create())}),[]),r.a.createElement("div",{className:"App bp3-dark"},l&&r.a.createElement(oe,{playerInfo:l}),r.a.createElement("div",{className:"screen-container"},!a&&r.a.createElement(ce,{logIn:p})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[148,1,2]]]);
//# sourceMappingURL=main.c140147a.chunk.js.map