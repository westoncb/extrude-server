(this["webpackJsonpextrude-client"]=this["webpackJsonpextrude-client"]||[]).push([[0],{148:function(e,t,a){e.exports=a(222)},152:function(e,t,a){},182:function(e,t){},186:function(e,t,a){},192:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(10),s=a.n(r),i=(a(152),a(3)),c=a(1),l=a(78),u=a(14),p=a(2),d=a(16),y=a(12),h=a(18),m=a(79),v=a.n(m),g=a(13),f=function(){function e(){Object(y.a)(this,e)}return Object(h.a)(e,null,[{key:"randString",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"computeCompositeBoundingBox",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];e.walkNodes(t,(function(e){e.geometry&&((!a.excludedTypes||!a.excludedTypes.includes(e.userData.objectType))&&n.push(e))}));var o=new c.Box3;return n.forEach((function(e){e.updateMatrixWorld();var t=e.geometry.clone();t.applyMatrix(e.matrixWorld),t.computeBoundingBox(),o=o.union(t.boundingBox)})),o}},{key:"walkNodes",value:function(t,a){a(t);for(var n=0;n<t.children.length;n+=1)e.walkNodes(t.children[n],a)}},{key:"rand",value:function(e,t){return Math.random()*(t-e)+e}},{key:"vec3ToScreenPoint",value:function(e,t,a,n){var o=e.clone(),r=.5*a,s=.5*n;return o.project(t),o.x=o.x*r+r,o.y=-o.y*s+s,{x:o.x,y:o.y}}},{key:"exponentialEaseOut",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}}]),e}(),b=function(){function e(){Object(y.a)(this,e)}return Object(h.a)(e,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.randString(f.rand(3,12));return{name:e,id:""+Math.round(1e4*Math.random()),position:new c.Vector3(f.rand(-100,100),0,f.rand(-100,100)),visibleMessages:[],keyStates:{},target:new c.Vector3,skindex:5003*e.length%13}}},{key:"addMessage",value:function(e,t){return Object(d.a)({},e,{visibleMessages:[].concat(Object(g.a)(e.visibleMessages),[t])})}},{key:"removeOldestMessage",value:function(e){var t=e.visibleMessages.slice();return t.shift(),Object(d.a)({},e,{visibleMessages:t})}}]),e}(),k=a(227),w=function(){function e(t,a,n){Object(y.a)(this,e),this.socket=null,this.state={players:{}},this.messages=[],this.localPlayerId=t.id,this.updatePlayers=a,this.updateMessagesFunc=n,this.state.players[t.id]=t,this.connectToServer(t)}return Object(h.a)(e,[{key:"connectToServer",value:function(e){var t=this;this.socket=v()("https://nameless-depths-23573.herokuapp.com"),this.socket.emit("event",{type:"player_enter_request",player:e}),this.socket.on("event",(function(e){t.handleServerEvent(e)})),this.socket.on("disconnect",(function(a){t.handleServerEvent({type:"player_exit",player:e})})),this.socket.on("reconnect",(function(a){t.socket.emit("event",{type:"player_enter_request",player:e})})),this.sendMouseMove=Object(k.a)((function(){return t.socket.emit("event",{type:"player_target_change",playerId:t.localPlayerId,target:t.getLocalPlayer().target})}),1e3),this.periodicSyncInterval=setInterval((function(){t.socket.emit("event",{type:"player_sync",player:t.getLocalPlayer()})}),2e3)}},{key:"handleServerEvent",value:function(e){var t,a=this;switch(e.playerId&&(t=this.state.players[e.playerId]),e.type){case"player_enter":console.log("player_enter: ",e.player),this.state.players[e.player.id]=e.player,this.updatePlayers(this.getPlayersArray());break;case"player_exit":console.log("player_exit: ",e.player),this.state.players[e.player.id]&&e.player.id!==this.localPlayerId&&(delete this.state.players[e.player.id],this.updatePlayers(this.getPlayersArray()));break;case"full_state_request":this.socket.emit("event",{type:"full_state_response",state:this.state});break;case"full_state_update":this.state=e.state,this.updatePlayers(this.getPlayersArray());break;case"input_key_down":this.serverKeyDown(e);break;case"input_key_up":this.serverKeyUp(e);break;case"input_mouse_move":case"input_click":break;case"chat_message":if(e.playerId&&!this.state.players[e.playerId])break;var n=Object(d.a)({},e,{player:t}),o=5e3+1e3*Math.floor(n.message.length/100);this.state.players=Object(d.a)({},this.state.players,Object(p.a)({},e.playerId,b.addMessage(t,n))),setTimeout((function(){a.state.players=Object(d.a)({},a.state.players,Object(p.a)({},e.playerId,b.removeOldestMessage(a.state.players[e.playerId]))),a.updatePlayers(Object.values(a.state.players))}),o),this.messages=this.messages.concat(n),this.updateMessagesFunc(this.messages),this.updatePlayers(Object.values(this.state.players));break;case"player_target_change":if(e.playerId&&!this.state.players[e.playerId])break;this.state.players=Object(d.a)({},this.state.players,Object(p.a)({},e.playerId,Object(d.a)({},t,{target:e.target}))),this.updatePlayers(Object.values(this.state.players));break;case"player_sync":if(e.player.id===this.localPlayerId)break;this.state.players[e.player.id]=e.player,this.updatePlayers(Object.values(this.state.players));break;default:console.log("unrecognized server event: ",e)}}},{key:"getPlayersArray",value:function(){var e=this;return Object.keys(this.state.players).map((function(t){return e.state.players[t]}))}},{key:"serverKeyDown",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!0}}},{key:"serverKeyUp",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!1}}},{key:"localKeyDown",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!0,this.socket.emit("event",{type:"input_key_down",playerId:this.localPlayerId,key:a}))}},{key:"localKeyUp",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!1,this.socket.emit("event",{type:"input_key_up",playerId:this.localPlayerId,key:a}))}},{key:"localMouseMove",value:function(e){this.sendMouseMove()}},{key:"localClick",value:function(e){this.socket.emit("event",{type:"input_click",playerId:this.localPlayerId})}},{key:"sendChatMessage",value:function(e){this.socket.emit("event",{type:"chat_message",message:e,playerId:this.localPlayerId,time:new Date})}},{key:"getLocalPlayer",value:function(){return this.state.players[this.localPlayerId]}}]),e}();w.RECOGNIZED_KEYS=["a","w","s","d","f","e","q"," "],w.KEY_TO_DIRECTION={a:"left",w:"up",s:"down",d:"right"};var O=w,j=a(93),E=a(25),S=a(38),M=a(49),x=a.n(M),I=a(81),P=a(53),_={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,crouch:!1,jump:!1,attack:!1},C=function(){function e(){Object(y.a)(this,e)}return Object(h.a)(e,null,[{key:"init",value:function(){var e=this,t={baseUrl:"models/ogro/",body:"ogro.md2",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png","sharokh.png"],weapons:[["weapon.md2","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:1e3,crouchSpeed:175};this.skinCount=t.skins.length,this.base=new P.a,this.base.scale=1,this.basePromise=new Promise((function(t,a){e.base.onLoadComplete=function(){e.base.enableShadows(!0),e.base.setSkin(2),t(e.base)}})),this.base.loadParts(t)}},{key:"customizeMovement",value:function(e){var t;e.updateMovementModel=(t=e,function(e){var a=t.controls;t.decceleration=1500,t.maxSpeed=t.walkSpeed,t.moveDirection||(t.moveDirection=new c.Vector3);var n=a.moveForward?1:0,o=a.moveBackward?-1:0,r=a.moveRight?-1:0,s=a.moveLeft?1:0,i=a.moveUp?1:0,l=a.moveDown?-1:0;t.impulseDirection=new c.Vector3(r+s,i+l,n+o),t.impulseDirection.normalize();var u=new c.Vector3(0,0,1).applyAxisAngle(new c.Vector3(0,1,0),t.bodyOrientation),p=new c.Vector3(t.target.x,t.target.y,t.target.z).clone().sub(t.root.position).normalize();p.y=0;var d=u.cross(p).y;if(t.bodyOrientation+=d*e*10,t.impulseDirection.applyAxisAngle(new c.Vector3(0,1,0),t.bodyOrientation),t.impulseDirection.length()>0&&t.moveDirection.copy(t.impulseDirection),Math.abs(d)>.2&&(t.speed=d*e*10,d<0?a.moveLeft=!0:a.moveRight=!0),t.impulseDirection.length()>0)t.speed=t.maxSpeed;else{var y=f.exponentialEaseOut(t.speed/t.maxSpeed);t.speed=c.MathUtils.clamp(t.speed-y*e*t.decceleration,0,t.maxSpeed)}var h=t.moveDirection.clone().multiplyScalar(t.speed*e/10);t.root.position.add(h),t.root.rotation.y=t.bodyOrientation})}},{key:"getModelInstance",value:function(){var e=Object(I.a)(x.a.mark((function e(){var t,a,n=arguments;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.instanceIndex,this.instanceIndex=(this.instanceIndex+1)%this.skinCount,(a=new P.a).scale=1,a.controls=this.getControlsCopy(),a.id=Math.random(),this.customizeMovement(a),e.next=9,this.basePromise.then((function(e){return a.shareParts(e),a.enableShadows(!0),a.setSkin(t),a.target=new c.Vector3,a.setWeapon(0),a}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getControlsCopy",value:function(){var e={};return Object.keys(_).forEach((function(t){return e[t]=_[t]})),e}}]),e}();C.instanceIndex=2,C.init();var D=C;a(186);var z=function(e){var t=e.player,a=e.messages,r=Object(n.useState)(null),s=Object(i.a)(r,2),l=s[0],p=s[1],d=Object(n.useState)(0),y=Object(i.a)(d,2),h=y[0],m=y[1],v=Object(n.useState)(null),g=Object(i.a)(v,2),b=g[0],k=g[1];return Object(n.useEffect)((function(){D.getModelInstance(t.skindex).then((function(e){var a=f.computeCompositeBoundingBox(e.root);m(a.getSize().y),p(e),e.root.position.set(t.position.x,e.root.position.y,t.position.z);var n=new S.a;n.setPositions([0,0,0,0,0,100]);var o=new E.a({color:1179494,linewidth:.003,vertexColors:!1,dashed:!1}),r=new j.a(n,o);r.computeLineDistances(),e.root.add(r),k(r)}))}),[]),Object(u.d)((function(e,a){if(l){l.controls.moveForward=t.keyStates.w,l.controls.moveBackward=t.keyStates.s,l.controls.moveLeft=t.keyStates.a,l.controls.moveRight=t.keyStates.d,l.controls.moveUp=t.keyStates.q,l.controls.moveDown=t.keyStates.e,l.controls.jump=t.keyStates[" "],l.controls.attack=t.keyStates.f,l.target=t.target,l.update(1.75*a),t.position.x=l.root.position.x,t.position.y=l.root.position.y,t.position.z=l.root.position.z;var n=new c.Vector3(t.position.x,t.position.y,t.position.z),o=new c.Vector3(l.target.x,l.target.y,l.target.z);o.sub(n),b.rotation.y=-l.bodyOrientation,b.geometry.setPositions([0,20,5,o.x,o.y,o.z]),b.geometry.needsUpdate=!0}})),o.a.createElement("mesh",null,l&&o.a.createElement(o.a.Fragment,null,o.a.createElement("primitive",{object:l.root,onClick:function(e){return console.log("click")}}),o.a.createElement(u.b,{center:!0,position:[t.position.x,t.position.y,t.position.z]},o.a.createElement("div",{className:"scene-label"},t.name)),a.map((function(e,a){return o.a.createElement(u.b,{key:e.time,center:!0,position:[t.position.x,t.position.y+h/1.5,t.position.z]},o.a.createElement("div",{style:{transform:"translateY(".concat(2.1*-a,"rem)")},className:"speech-bubble"},e.message))}))))},V=(a(192),a(226));var N=function(e){var t=e.sendChatMessage,a=e.messages,r=e.hideChat,s=Object(n.useState)(""),c=Object(i.a)(s,2),l=c[0],u=c[1],p=Object(n.useRef)();return Object(n.useEffect)((function(){p.current.scrollTop=p.current.scrollHeight}),[a]),o.a.createElement("div",{className:"ChatWindow"},o.a.createElement("div",{className:"all-messages",ref:p},a.map((function(e){return o.a.createElement("div",{className:"chat-message",key:e.time},o.a.createElement("div",{className:"chat-message-name"},e.player.name,":"),o.a.createElement("div",{className:"chat-message-content"},e.message))}))),o.a.createElement(V.c,{className:"your-message",placeholder:"your message...",large:!0,onKeyDown:function(e){13===e.which?(t(l),u("")):27===e.which&&r()},value:l,onChange:function(e){return u(e.target.value)},autoFocus:!0}))},R=a(90),B=a(89),A=a(91),L=a(92);a(219);Object(u.c)({EffectComposer:R.a,RenderPass:B.a,UnrealBloomPass:L.a,SSAOPass:A.a});var K=new l.a,T=new c.Vector3(0,100,100),U=new c.Vector3(0,0,0),F=(new c.Vector3,new c.Vector3),W=1,G=function(e){var t=e.playground,a=e.setChatVisible,o=e.chatVisible,r=Object(u.e)(),s=r.camera,i=r.gl;return Object(u.d)((function(){K.update();var e=t.getLocalPlayer().position,a=t.getLocalPlayer().target,n=new c.Vector3(e.x,e.y,e.z),o=n.set(n.x,n.y+70,n.z),r=new c.Vector3(a.x,a.y,a.z).clone().sub(o).normalize().clone().multiplyScalar(-200*W);r.z=Math.max(Math.abs(r.z),50)*Math.sign(r.z),r.y=Math.max(r.y,50),T.copy(n.clone().add(r)),U.copy(n);var i=c.MathUtils.clamp(s.position.clone().sub(T).length()/10,.1,4);s.position.copy(s.position.lerp(T,.005*i));var l=F.lerp(U,.05).clone();s.lookAt(l),s.updateProjectionMatrix(),F.copy(l)})),Object(n.useEffect)((function(){i.domElement.onclick=function(e){a(!1),t&&t.localClick(e)},window.onkeydown=function(e){"t"===e.key?(o||e.preventDefault(),a(!0)):27===e.which&&a(!o),t&&!o&&t.localKeyDown(e)},window.onkeyup=function(e){t&&t.localKeyUp(e)},i.domElement.onmousemove=function(e){t&&t.localMouseMove(e)},i.domElement.onwheel=function(e){e.preventDefault(),W+=.01*e.deltaY,W=Math.min(Math.max(.05,W),3)}}),[i,t,o]),null};function Y(e){var t=e.ssao,a=e.bloom,r=Object(u.e)(),s=r.gl,i=r.scene,c=r.camera,l=r.size,p=Object(n.useRef)();return Object(n.useEffect)((function(){p.current.setSize(l.width,l.height)}),[l]),Object(u.d)((function(){return p.current.render()}),1),o.a.createElement("effectComposer",{ref:p,args:[s]},o.a.createElement("renderPass",{attachArray:"passes",args:[i,c]}),a&&o.a.createElement("unrealBloomPass",{attachArray:"passes",args:[void 0,1.5,.4,.6],bloomThreshold:1,bloomStrength:1,bloomRadius:0}),t&&o.a.createElement("sSAOPass",{attachArray:"passes",args:[i,c,l.width,l.height],kernelRadius:16,minDistance:.005,maxDistance:50}))}var q=function(e){var t=e.player,a=Object(n.useState)([]),r=Object(i.a)(a,2),s=r[0],l=r[1],p=Object(n.useState)([]),d=Object(i.a)(p,2),y=d[0],h=d[1],m=Object(n.useState)(null),v=Object(i.a)(m,2),g=v[0],f=v[1],b=Object(n.useState)(!1),k=Object(i.a)(b,2),w=k[0],j=k[1],E=Object(n.useMemo)((function(){return(new c.TextureLoader).load("rust2.jpg")}),[]);return Object(n.useEffect)((function(){f(new O(t,(function(e){return l(e)}),(function(e){return h(e)})))}),[t]),o.a.createElement("div",{className:"main-canvas-container"},o.a.createElement(u.a,{style:{backgroundColor:"#789"},gl:{antialias:!1,alpha:!1},pixelRatio:window.devicePixelRatio,camera:{position:[0,10,10],near:1,far:4e3},shadowMap:!0,onCreated:function(e){var t=e.gl;t.toneMapping=c.Uncharted2ToneMapping,t.outputEncoding=c.sRGBEncoding,t.shadowMap.type=c.PCFSoftShadowMap,t.setClearColor(new c.Color("#667788"))}},o.a.createElement(Y,null),o.a.createElement(G,{playground:g,setChatVisible:j,chatVisible:w}),o.a.createElement("fog",{attach:"fog",args:[6715272,1e3,4e3]}),o.a.createElement("ambientLight",{args:[6710886]}),o.a.createElement("directionalLight",{args:[16777215,7],position:[0,6e3,3e3],"shadow-camera-left":-1e3,"shadow-camera-bottom":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-near":1,"shadow-camera-far":12e3,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,castShadow:!0}),s.map((function(e){return o.a.createElement(z,{key:e.id,player:e,messages:e.visibleMessages})})),o.a.createElement("mesh",{receiveShadow:!0,"rotation-x":-Math.PI/2,onPointerMove:function(e){return g.getLocalPlayer().target=e.point}},o.a.createElement("planeBufferGeometry",{attach:"geometry",args:[16e3,16e3]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:3355443,roughness:.55,metalness:.8},o.a.createElement("primitive",{attach:"map",object:E,repeat:[64,64],wrapS:c.RepeatWrapping,wrapT:c.RepeatWrapping,encoding:c.sRGBEncoding})))),g&&w&&o.a.createElement(N,{sendChatMessage:g.sendChatMessage.bind(g),messages:y,hideChat:function(){return j(!1)}}))};a(220);var J=function(e){var t=e.logIn,a=Object(n.useState)(""),r=Object(i.a)(a,2),s=r[0],c=r[1];return o.a.createElement("div",{className:"login-container bp3-light"},o.a.createElement(V.b,{label:"Choose a name to use:"},o.a.createElement(V.c,{autoFocus:!0,placeholder:"name...",large:!0,onChange:function(e){var t=e.target.value||"";c(t)},onKeyDown:function(e){return 13===e.which?t(b.create(s)):""}})),o.a.createElement(V.a,{onClick:function(){t(b.create(s))}},"Join"))};a(221);var Z=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],r=t[1],s=Object(n.useState)(null),c=Object(i.a)(s,2),l=c[0],u=c[1],p=function(e){u(e),r(!0)};return Object(n.useEffect)((function(){0}),[]),o.a.createElement("div",{className:"App bp3-dark"},l&&o.a.createElement(q,{player:l}),o.a.createElement("div",{className:"screen-container"},!a&&o.a.createElement(J,{logIn:p})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[148,1,2]]]);
//# sourceMappingURL=main.a720a61c.chunk.js.map