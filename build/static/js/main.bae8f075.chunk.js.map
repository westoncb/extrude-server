{"version":3,"sources":["Util.js","PlayerData.js","playground.js","ModelFactory.js","components/Player.js","components/ChatWindow.js","MainCanvas.js","components/LoginPrompt.js","App.js","serviceWorker.js","index.js"],"names":["Util","length","result","characters","charactersLength","i","charAt","Math","floor","random","obj3d","options","allMeshes","walkNodes","node","geometry","excludedTypes","includes","userData","objectType","push","totalBox","Box3","forEach","mesh","updateMatrixWorld","geometryCopy","clone","applyMatrix","matrixWorld","computeBoundingBox","union","boundingBox","func","children","min","max","vector","camera","canvasWidth","canvasHeight","vectorCopy","widthHalf","heightHalf","project","x","y","k","pow","Player","name","randString","rand","id","round","position","Vector3","visibleMessages","keyStates","target","skindex","player","message","slice","shift","Playground","updatePlayers","updateMessagesFunc","socket","state","players","messages","this","localPlayerId","connectToServer","io","emit","type","on","data","handleServerEvent","sendMouseMove","throttle","playerId","getLocalPlayer","event","console","log","getPlayersArray","serverKeyDown","serverKeyUp","messageDisplayTime","addMessage","setTimeout","removeOldestMessage","Object","values","concat","keys","map","key","e","RECOGNIZED_KEYS","time","Date","KEY_TO_DIRECTION","a","w","s","d","MD2_CONTROLS","moveForward","moveBackward","moveLeft","moveRight","crouch","jump","attack","ModelFactory","configOgro","baseUrl","body","skins","weapons","animations","move","idle","crouchMove","crouchIdle","crouchAttach","walkSpeed","crouchSpeed","skinCount","base","MD2CharacterComplex","scale","basePromise","Promise","resolve","reject","onLoadComplete","enableShadows","setSkin","loadParts","instance","self","updateMovementModel","delta","angularSpeed","controls","forwardVec","applyAxisAngle","bodyOrientation","toTarget","z","sub","root","normalize","rotationGap","cross","abs","speed","maxSpeed","maxReverseSpeed","exponentialEaseOut","MathUtils","clamp","frontDecceleration","backAcceleration","forwardDelta","sin","cos","rotation","skin","instanceIndex","getControlsCopy","customizeMovement","then","shareParts","setWeapon","init","useState","md2","setMd2","height","setHeight","useEffect","getModelInstance","bbox","computeCompositeBoundingBox","getSize","set","useFrame","info","update","object","onClick","center","className","style","transform","ChatWindow","sendChatMessage","hideChat","inputText","setInputText","allMessagesRef","useRef","current","scrollTop","scrollHeight","ref","placeholder","large","onKeyDown","which","value","onChange","autoFocus","stats","Stats","camDest","camZoom","CameraController","playground","setChatVisible","chatVisible","useThree","gl","positionObj","targetObj","copy","add","multiplyScalar","lerp","lookAt","updateProjectionMatrix","domElement","onclick","localClick","window","onkeydown","preventDefault","localKeyDown","onkeyup","localKeyUp","onmousemove","localMouseMove","onwheel","deltaY","MainCanvas","setPlayers","setMessages","setPlayground","grassTexture","useMemo","THREE","load","backgroundColor","antialias","alpha","pixelRatio","devicePixelRatio","near","far","shadowMap","onCreated","toneMapping","outputEncoding","attach","args","shadow-camera-left","shadow-camera-bottom","shadow-camera-right","shadow-camera-top","shadow-camera-near","shadow-camera-far","shadow-mapSize-width","shadow-mapSize-height","castShadow","receiveShadow","rotation-x","PI","onPointerMove","point","repeat","wrapS","wrapT","encoding","bind","LoginPrompt","logIn","setName","label","text","create","App","loggedIn","setLoggedIn","setPlayer","doLogin","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error"],"mappings":"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","file":"static/js/main.bae8f075.chunk.js","sourcesContent":["import {Box3} from 'three'\n\nclass Util {\n    static randString(length) {\n        var result = ''\n        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'\n        var charactersLength = characters.length\n        for (var i = 0; i < length; i++) {\n            result += characters.charAt(Math.floor(Math.random() * charactersLength))\n        }\n        return result\n    }\n\n    /*\n        Computes a bounding box which is the union of the geometry\n        belonging to the passed in node and all descendent meshes.\n        This exists because the Three.Box3().setFromObject() method\n        is brokenâ€”possibly having to do with THREE.Group nodes.\n    */\n    static computeCompositeBoundingBox(obj3d, options = {}) {\n        const allMeshes = [];\n\n        Util.walkNodes(obj3d, node => {\n            if (node.geometry) {\n                const notExcluded =\n                    !options.excludedTypes ||\n                    !options.excludedTypes.includes(node.userData.objectType);\n\n                if (notExcluded) allMeshes.push(node);\n            }\n        });\n\n        let totalBox = new Box3();\n        allMeshes.forEach(mesh => {\n            mesh.updateMatrixWorld();\n            const geometryCopy = mesh.geometry.clone();\n            geometryCopy.applyMatrix(mesh.matrixWorld);\n            geometryCopy.computeBoundingBox();\n            totalBox = totalBox.union(geometryCopy.boundingBox);\n        });\n\n        return totalBox;\n    }\n\n    /*\n        Depth first walk of a three.js node and all of its children.\n        The passed in function is called at each node, and the current\n        node is passed in as the sole argument.\n    */\n    static walkNodes(node, func) {\n        func(node);\n\n        for (let i = 0; i < node.children.length; i += 1) {\n            Util.walkNodes(node.children[i], func);\n        }\n    }\n\n    static rand(min, max) {\n        return Math.random() * (max - min) + min\n    }\n\n    static vec3ToScreenPoint(vector, camera, canvasWidth, canvasHeight) {\n        // Make a copy since .project(...) will transform the vector\n        const vectorCopy = vector.clone();\n\n        const widthHalf = 0.5 * canvasWidth;\n        const heightHalf = 0.5 * canvasHeight;\n\n        vectorCopy.project(camera);\n\n        vectorCopy.x = vectorCopy.x * widthHalf + widthHalf;\n        vectorCopy.y = -(vectorCopy.y * heightHalf) + heightHalf;\n\n        return {\n            x: vectorCopy.x,\n            y: vectorCopy.y,\n        };\n    }\n\n    static exponentialEaseOut(k) {\n        return k === 1 ? 1 : - Math.pow(2, - 10 * k) + 1;\n    }\n}\n\nexport default Util","import  {Vector3} from \"three\"\nimport Util from './Util'\n\nconst player_skin_count = 13\n\nclass Player {\n\n    static create(name = Util.randString(Util.rand(3, 12))) {\n        return  {\n                    name,\n                    id: \"\"+Math.round(Math.random() * 10000), //Important this is a string!\n                    position: new Vector3(Util.rand(-100, 100), 0, Util.rand(-100, 100)),\n                    visibleMessages: [],\n                    keyStates: {},\n                    target: new Vector3(),\n                    skindex: (name.length * 5003) % player_skin_count\n                }\n    }\n\n    static addMessage(player, message) {\n        const newPlayer = {...player, visibleMessages: [...player.visibleMessages, message]}\n        return newPlayer\n    }\n\n    static removeOldestMessage(player) {\n        const visibleMessages = player.visibleMessages.slice()\n        visibleMessages.shift()\n        return {...player, visibleMessages}\n    }\n}\n\nexport default Player","import io from \"socket.io-client\"\nimport Player from './PlayerData'\nimport {throttle} from 'lodash-es'\n\nconst isProduction = process.env.NODE_ENV !== 'development'\nconst port = 3000\nconst devURL = \"localhost:\" + port\nconst prodURL = \"https://nameless-depths-23573.herokuapp.com\"\nconst serverURL = isProduction ? prodURL : devURL\n\nclass Playground {\n    localPlayerId\n    socket = null\n    state = {players: {}}\n    messages = []\n\n    static RECOGNIZED_KEYS = [\"a\", \"w\", \"s\", \"d\", \"f\", \"e\", \"q\", \" \"]\n    static KEY_TO_DIRECTION = { a: 'left', w: \"up\", s: \"down\", d: \"right\"}\n\n    constructor(player, updatePlayers, updateMessagesFunc) {\n        this.localPlayerId = player.id\n        this.updatePlayers = updatePlayers\n        this.updateMessagesFunc = updateMessagesFunc\n        this.state.players[player.id] = player\n\n        this.connectToServer(player)\n    }\n\n    connectToServer(player) {\n        this.socket = io(serverURL)\n        this.socket.emit(\"event\", { type: \"player_enter_request\", player })\n\n        this.socket.on(\"event\", data => {\n            // console.log(\"server event: \", data)\n\n            this.handleServerEvent(data)\n        })\n\n        this.socket.on(\"disconnect\", data => {\n            // This is a hack: it's not a server event, but we\n            // want to use the same logic for now\n            this.handleServerEvent({type: \"player_exit\", player})\n        })\n\n        this.socket.on(\"reconnect\", data => {\n            this.socket.emit(\"event\", { type: \"player_enter_request\", player })\n        })\n\n        this.sendMouseMove = throttle(() => this.socket.emit(\"event\", { type: \"player_target_change\", playerId: this.localPlayerId, target: this.getLocalPlayer().target }), 500)\n    }\n\n    handleServerEvent(event) {\n        \n        let player\n        if (event.playerId)\n            player = this.state.players[event.playerId]\n\n        switch (event.type) {\n            case \"player_enter\":\n                console.log(\"player_enter: \", event.player)\n                this.state.players[event.player.id] = event.player\n                this.updatePlayers(this.getPlayersArray())\n                break;\n            case \"player_exit\":\n                if (this.state.players[event.player.id] && event.player.id !== this.localPlayerId) {\n                    delete this.state.players[event.player.id]\n                    this.updatePlayers(this.getPlayersArray())\n                }\n                break;\n            case \"full_state_request\":\n                this.socket.emit(\"event\", { type: \"full_state_response\", state: this.state})\n                break;\n            case \"full_state_update\":\n                this.state = event.state\n                this.updatePlayers(this.getPlayersArray())\n                break;\n            case \"input_key_down\":\n                this.serverKeyDown(event)\n                break;\n            case \"input_key_up\":\n                this.serverKeyUp(event)\n                break;\n            case \"input_mouse_move\":\n\n                break;\n            case \"input_click\":\n\n                break;\n            case \"chat_message\":\n                if ((event.playerId && !this.state.players[event.playerId])) {\n                    break\n                }\n\n                const message = {...event, player}\n                const messageDisplayTime = 5000 + (1000 * Math.floor(message.message.length / 100))\n                this.state.players = { ...this.state.players, [event.playerId]: Player.addMessage(player, message)}\n\n                setTimeout(() => {\n                    this.state.players = { ...this.state.players, [event.playerId]: Player.removeOldestMessage(this.state.players[event.playerId])}\n                    this.updatePlayers(Object.values(this.state.players))\n                }, messageDisplayTime)\n\n                this.messages = this.messages.concat(message)\n                this.updateMessagesFunc(this.messages)\n                this.updatePlayers(Object.values(this.state.players))\n                break;\n            case \"player_target_change\":\n                if ((event.playerId && !this.state.players[event.playerId])) {\n                    break\n                }\n\n                this.state.players = { ...this.state.players, [event.playerId]: {...player, target: event.target} }\n                this.updatePlayers(Object.values(this.state.players))\n                break;\n            default:\n                console.log(\"unrecognized server event: \", event)\n                break;\n        }\n    }\n\n    getPlayersArray() {\n        return Object.keys(this.state.players).map(key => this.state.players[key])\n    }\n\n    /////\n    // Server event handlers\n    ////\n\n    serverKeyDown(event) {\n        if (event.playerId === this.localPlayerId)\n            return\n\n        const key = event.key\n        this.state.players[event.playerId].keyStates[key] = true\n    }\n\n    serverKeyUp(event) {\n        if (event.playerId === this.localPlayerId)\n            return\n\n        const key = event.key\n        this.state.players[event.playerId].keyStates[key] = false\n    }\n\n    /////\n    // Local input handlers\n    ////\n\n    localKeyDown(e) {\n        const key = e.key\n\n        if (!Playground.RECOGNIZED_KEYS.includes(key))\n            return\n\n        this.state.players[this.localPlayerId].keyStates[key] = true\n\n        this.socket.emit(\"event\", { type: \"input_key_down\", playerId: this.localPlayerId, key })\n    }\n\n    localKeyUp(e) {\n        const key = e.key\n\n        if (!Playground.RECOGNIZED_KEYS.includes(key))\n            return\n\n        this.state.players[this.localPlayerId].keyStates[key] = false\n\n        this.socket.emit(\"event\", { type: \"input_key_up\", playerId: this.localPlayerId, key })\n    }\n\n    localMouseMove(e) {\n        this.sendMouseMove()\n    }\n\n    localClick(e) {\n        this.socket.emit(\"event\", { type: \"input_click\", playerId: this.localPlayerId})\n    }\n\n    sendChatMessage(message) {\n        this.socket.emit(\"event\", {type: \"chat_message\", message, playerId: this.localPlayerId, time: new Date()})\n    }\n\n    getLocalPlayer() {\n        return this.state.players[this.localPlayerId]\n    }\n}\n\nexport default Playground","import { MD2CharacterComplex } from 'three/examples/jsm/misc/MD2CharacterComplex.js';\nimport { MathUtils, Vector3 } from 'three'\nimport Util from './Util'\n\nconst WEAPONS_ENABLED = true\nconst MD2_SCALE = 1\nconst MD2_CONTROLS = {\n    moveForward: false,\n    moveBackward: false,\n    moveLeft: false,\n    moveRight: false,\n    crouch: false,\n    jump: false,\n    attack: false\n}\n\nclass ModelFactory {\n    static base\n    static skinCount\n    static instanceIndex = 2\n\n    static init() {\n        \n\n        const configOgro = {\n\n            baseUrl: \"models/ogro/\",\n\n            body: \"ogro.md2\",\n            skins: [\"grok.jpg\", \"ogrobase.png\", \"arboshak.png\", \"ctf_r.png\", \"ctf_b.png\", \"darkam.png\", \"freedom.png\",\n                \"gib.png\", \"gordogh.png\", \"igdosh.png\", \"khorne.png\", \"nabogro.png\",\n                \"sharokh.png\"],\n            weapons: [[\"weapon.md2\", \"weapon.jpg\"]],\n            animations: {\n                move: \"run\",\n                idle: \"stand\",\n                jump: \"jump\",\n                attack: \"attack\",\n                crouchMove: \"cwalk\",\n                crouchIdle: \"cstand\",\n                crouchAttach: \"crattack\"\n            },\n\n            walkSpeed: 800,\n            crouchSpeed: 175\n        }\n\n        this.skinCount = configOgro.skins.length\n\n        this.base = new MD2CharacterComplex()\n        this.base.scale = MD2_SCALE;\n        this.basePromise = new Promise((resolve, reject) => {\n            this.base.onLoadComplete = () => {\n                this.base.enableShadows(true)\n                this.base.setSkin(2);\n                resolve(this.base)\n            }\n        })\n        this.base.loadParts(configOgro);\n    }\n\n    static customizeMovement(instance) {\n\n        // We use this to override a function defined\n        // on MD2CharacterComplex\n        const customUpdateMovementModel = self => {\n            return delta => {\n                self.angularSpeed = 4\n                var controls = self.controls;\n\n                // Rotate toward 'target' (where ray cast from cursor hits scene object)\n                const forwardVec = new Vector3(0, 0, 1).applyAxisAngle(new Vector3(0, 1, 0), self.bodyOrientation)\n                const target = new Vector3(self.target.x, self.target.y, self.target.z)\n                const toTarget = target.clone().sub(self.root.position).normalize()\n                toTarget.y = 0\n                const rotationGap = forwardVec.cross(toTarget).y\n                self.bodyOrientation += rotationGap * delta * 10\n\n                // Animate while turning\n                if (Math.abs(rotationGap) > 0.2) {\n                    self.speed = rotationGap * delta * 10\n                    if (rotationGap < 0)\n                        controls.moveLeft = true\n                    else\n                        controls.moveRight = true\n                } else {\n                    controls.moveLeft = false\n                    controls.moveRight = false\n                }\n\n                // speed based on controls\n\n                if (controls.crouch) self.maxSpeed = self.crouchSpeed;\n                else self.maxSpeed = self.walkSpeed;\n\n                self.maxReverseSpeed = - self.maxSpeed;\n\n                if (controls.moveForward) self.speed = self.maxSpeed//MathUtils.clamp(self.speed + delta * self.frontAcceleration, self.maxReverseSpeed, self.maxSpeed);\n                if (controls.moveBackward) self.speed = self.maxReverseSpeed//MathUtils.clamp(self.speed - delta * self.backAcceleration, self.maxReverseSpeed, self.maxSpeed);\n\n                // speed decay\n\n                if (!(controls.moveForward || controls.moveBackward)) {\n\n                    if (self.speed > 0) {\n\n                        const k = Util.exponentialEaseOut(self.speed / self.maxSpeed);\n                        self.speed = MathUtils.clamp(self.speed - k * delta * self.frontDecceleration, 0, self.maxSpeed);\n\n                    } else {\n\n                        const k = Util.exponentialEaseOut(self.speed / self.maxReverseSpeed);\n                        self.speed = MathUtils.clamp(self.speed + k * delta * self.backAcceleration, self.maxReverseSpeed, 0);\n\n                    }\n\n                }\n\n                // displacement\n\n                const forwardDelta = self.speed * delta / 10;\n\n                self.root.position.x += Math.sin(self.bodyOrientation) * forwardDelta;\n                self.root.position.z += Math.cos(self.bodyOrientation) * forwardDelta;\n\n                // steering\n\n                self.root.rotation.y = self.bodyOrientation;\n            }\n        }\n\n        instance.updateMovementModel = customUpdateMovementModel(instance)\n    }\n\n    static async getModelInstance(skin = this.instanceIndex) {\n        this.instanceIndex = (this.instanceIndex + 1) % this.skinCount\n\n        const instance = new MD2CharacterComplex()\n        instance.scale = MD2_SCALE\n        instance.controls = this.getControlsCopy()\n        instance.id = Math.random()\n        this.customizeMovement(instance)\n\n        return await this.basePromise.then(base => {\n            instance.shareParts(base)\n            instance.enableShadows(true);\n            instance.setSkin(skin)\n            instance.target = new Vector3()\n\n            if (WEAPONS_ENABLED)\n                instance.setWeapon(0)\n\n            return instance\n        })\n    }\n\n    static getControlsCopy() {\n        const controls = {}\n        Object.keys(MD2_CONTROLS).forEach(key => controls[key] = MD2_CONTROLS[key])\n        return controls\n    }\n}\n\nModelFactory.init()\n\nexport default ModelFactory","import React, { useEffect, useMemo, useState } from 'react'\nimport * as THREE from 'three'\nimport { useFrame, Dom } from 'react-three-fiber'\nimport ModelFactory from '../ModelFactory'\nimport Util from '../Util'\nimport './Player.css'\n\n// let imageCapture\n// let texture\n// let outerTick = 0\n\nfunction Player({ player, messages }) {\n    const [md2, setMd2] = useState(null)\n    const [height, setHeight] = useState(0)\n    // const [tick, setTick] = useState(0)\n\n    useEffect(() => {\n        ModelFactory.getModelInstance(player.skindex).then(instance => {\n            const bbox = Util.computeCompositeBoundingBox(instance.root)\n\n            setHeight(bbox.getSize().y)\n            setMd2(instance)\n\n            instance.root.position.set(player.position.x, instance.root.position.y, player.position.z)\n        })\n    }, [])\n\n    // useEffect(() => {\n    //     setInterval(() => {\n    //         setTick(++outerTick)\n    //     }, 400)\n    // }, [])\n\n    // const vidTex = useMemo(() => {\n    //     return getVideoTexture()\n    // }, [tick])\n\n    useFrame(info => {\n        if (md2) {\n            md2.controls.moveForward = player.keyStates['w']\n            md2.controls.moveBackward = player.keyStates['s']\n            md2.controls.moveLeft = player.keyStates['a']\n            md2.controls.moveRight = player.keyStates['d']\n            md2.controls.jump = player.keyStates[' ']\n            md2.controls.attack = player.keyStates['f']\n            md2.target = player.target\n            md2.update(.020)\n            player.position.x = md2.root.position.x\n            player.position.z = md2.root.position.z\n        }\n    })\n\n    return (\n        <mesh>\n            {md2 && \n                <>\n                    <primitive object={md2.root} onClick={e => console.log('click')}>\n                        {/* <mesh position={[0, 200, -100]}>\n                            <planeBufferGeometry attach=\"geometry\" args={[250, 150]} />\n                            <meshBasicMaterial attach=\"material\" side={THREE.DoubleSide}>\n                                <primitive attach=\"map\" object={vidTex} wrapS={THREE.ClampToEdgeWrapping} wrapT={THREE.ClampToEdgeWrapping} encoding={THREE.sRGBEncoding}/>\n                            </meshBasicMaterial>\n                        </mesh> */}\n                    </primitive>\n\n                    <Dom center position={[player.position.x, player.position.y, player.position.z]}>\n                        <div className=\"scene-label\">{player.name}</div>\n                    </Dom>\n\n                    {messages.map((message, i) => (\n                        <Dom key={message.time} center position={[player.position.x, player.position.y + height/1.5, player.position.z]}>\n                            <div style={{transform: `translateY(${-i*2.1}rem)`}} className=\"speech-bubble\">{message.message}</div>\n                        </Dom>\n                    ))}\n                </>\n            }\n        </mesh>\n    )\n}\n\n// function getVideoTexture() {\n//     if (!texture)\n//         texture = new THREE.Texture()\n\n//     var video = document.getElementById('video');\n\n//     const drawCanvas = img => {\n//         const canvas = document.getElementById('test-canvas');\n//         canvas.width = getComputedStyle(canvas).width.split('px')[0];\n//         canvas.height = getComputedStyle(canvas).height.split('px')[0];\n//         let ratio = Math.min(canvas.width / img.width, canvas.height / img.height);\n//         let x = (canvas.width - img.width * ratio) / 2;\n//         let y = (canvas.height - img.height * ratio) / 2;\n//         canvas.getContext('2d').clearRect(0, 0, canvas.width, canvas.height);\n//         canvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height,\n//             x, y, img.width * ratio, img.height * ratio);\n\n//         canvas.width = 256\n//         canvas.height = 256\n//         canvas.style.width = \"256px\"\n//         canvas.style.height = \"256px\"\n\n//         return canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height)\n//     }\n\n//     const updateTexture = async imageCapture => {\n//         const { imageWidth, imageHeight } = await imageCapture.getPhotoCapabilities();\n//         // console.log(\"asdf\", imageWidth, imageHeight)\n\n//         imageCapture.takePhoto({imageWidth: imageWidth.min, imageHeight: imageHeight.min})\n//             .then(blob => createImageBitmap(blob))\n//             .then(imageBitmap => {\n//                 texture.image = drawCanvas(imageBitmap)\n//                 texture.format = THREE.RGBAFormat\n//                 texture.needsUpdate = true\n//             })\n//             .catch(error => console.log(error));\n//     }\n\n//     if (!imageCapture) {\n//         navigator.mediaDevices.getUserMedia({ video: true, audio: false })\n//             .then(mediaStream => {\n//                 video.srcObject = mediaStream;\n\n//                 const track = mediaStream.getVideoTracks()[0];\n//                 imageCapture = new ImageCapture(track);\n\n//                 return imageCapture\n//             }).then(imageCapture => {\n//                 updateTexture(imageCapture)\n//             }).catch(error => console.log('Error with video stream capture', error.name || error))\n//     } else {\n\n//         updateTexture(imageCapture)\n//     }\n\n//     return texture\n// }\n\nexport default Player","import React, {useState, useRef, useEffect} from 'react'\nimport './ChatWindow.css'\nimport {InputGroup} from '@blueprintjs/core'\n\nfunction ChatWindow({sendChatMessage, messages, hideChat}) {\n    const [inputText, setInputText] = useState(\"\")\n    const allMessagesRef = useRef()\n\n    const handleKeyDown = e => {\n        if (e.which === 13) { //check for 'enter' press\n            sendChatMessage(inputText)\n            setInputText(\"\")\n        } else if (e.which === 27) { //escape key\n            hideChat()\n        }\n    }\n\n    useEffect(() => {\n        allMessagesRef.current.scrollTop = allMessagesRef.current.scrollHeight\n    }, [messages])\n\n    return (\n        <div className=\"ChatWindow\">\n            <div className=\"all-messages\" ref={allMessagesRef}>\n                {messages.map(message => (\n                    <div className=\"chat-message\" key={message.time}>\n                        <div className=\"chat-message-name\">{message.player.name}:</div>\n                        <div className=\"chat-message-content\">{message.message}</div>\n                    </div>\n                ))}\n            </div>\n            <InputGroup\n                className=\"your-message\"\n                placeholder=\"your message...\"\n                large\n                onKeyDown={handleKeyDown}\n                value={inputText}\n                onChange={event => setInputText(event.target.value)}\n                autoFocus\n            />\n        </div>\n    )\n}\n\nexport default ChatWindow","import React, {useMemo, useEffect, useState, useRef} from 'react'\nimport * as THREE from 'three'\nimport Stats from 'three/examples/jsm/libs/stats.module.js'\nimport { Canvas, extend, useThree, useFrame } from 'react-three-fiber'\nimport Playground from './playground'\nimport Player from './components/Player'\nimport ChatWindow from './components/ChatWindow'\n// import { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer'\n// import { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass'\n// import { SSAOPass } from 'three/examples/jsm/postprocessing/SSAOPass'\nimport './MainCanvas.css'\nimport { Vector3, MathUtils } from 'three'\n\n// extend({ EffectComposer, RenderPass, SSAOPass })\n\nconst stats = new Stats()\nconst camDest = new Vector3()\n\nlet camZoom = 1\n\nconst CameraController = ({playground, setChatVisible, chatVisible}) => {\n    const { camera, gl } = useThree();\n\n    useFrame(() => {\n        stats.update()\n        const positionObj = playground.getLocalPlayer().position\n        const targetObj = playground.getLocalPlayer().target\n        const position = new Vector3(positionObj.x, positionObj.y + 70, positionObj.z)\n        const target = new Vector3(targetObj.x, targetObj.y, targetObj.z)\n\n        const toTarget = target.sub(position).normalize()\n\n        camDest.copy(position.clone().add(toTarget.multiplyScalar(-200 * camZoom)))\n        camDest.y = Math.max(camDest.y, 100)\n\n        const scale = MathUtils.clamp(camera.position.clone().sub(camDest).length() / 10, 0.1, 4)\n        camera.position.copy(camera.position.lerp(camDest, 0.0025 * scale))\n        \n        camera.lookAt(position)\n        camera.updateProjectionMatrix()\n    })\n\n    // should be in a different component...\n    useEffect(() => {\n        gl.domElement.onclick = e => {\n            setChatVisible(false)\n\n            if (playground)\n                playground.localClick(e)\n        }\n        window.onkeydown = e => {\n\n            if (e.key === 't') {\n                if (!chatVisible) {\n                    e.preventDefault()\n                }\n\n                setChatVisible(true)\n            } else if (e.which === 27) { //escape key\n                setChatVisible(!chatVisible)\n            }\n                \n\n            if (playground && !chatVisible)\n                playground.localKeyDown(e)\n        }\n        window.onkeyup = e => {\n            if (playground)\n                playground.localKeyUp(e)\n        }\n        gl.domElement.onmousemove = e => {\n            if (playground)\n                playground.localMouseMove(e)\n        }\n\n        gl.domElement.onwheel = event => {\n            event.preventDefault();\n            camZoom += event.deltaY * 0.01;\n            camZoom = Math.min(Math.max(.05, camZoom), 3);\n        }\n    }, [gl, playground, chatVisible])\n\n    return null;\n}\n\n// function Effects() {\n//     const { gl, scene, camera, size } = useThree()\n//     const composer = useRef()\n//     useEffect(() => void composer.current.setSize(size.width, size.height), [size])\n//     useFrame(() => composer.current.render(), 1)\n//     return (\n//         <effectComposer ref={composer} args={[gl]}>\n//             <renderPass attachArray=\"passes\" args={[scene, camera]} />\n//             <sSAOPass attachArray=\"passes\" args={[scene, camera, size.width, size.height]}/>\n//         </effectComposer>\n//     )\n// }\n\nfunction MainCanvas({player}) {\n    const [players, setPlayers] = useState([])\n    const [messages, setMessages] = useState([])\n    const [playground, setPlayground] = useState(null)\n    const [chatVisible, setChatVisible] = useState(false)\n    const grassTexture = useMemo(() => new THREE.TextureLoader().load(\"grasslight-big.jpg\"), [])\n\n    useEffect(() => {\n        setPlayground(new Playground(player, players => setPlayers(players), messages => setMessages(messages)))\n    }, [player])\n\n    return (\n        <div className=\"main-canvas-container\">\n            <Canvas\n                style={{ backgroundColor: \"#789\" }}\n                gl={{ antialias: false, alpha: true }}\n                pixelRatio={window.devicePixelRatio}\n                camera={{ position: [0, 10, 10], near: 1, far: 4000 }}\n                shadowMap\n                onCreated={({ gl }) => {\n                    gl.toneMapping = THREE.ReinhardToneMapping\n                    gl.outputEncoding = THREE.sRGBEncoding\n                    gl.shadowMap.type = THREE.PCFSoftShadowMap\n                }}\n            >\n                {/* <Effects /> */}\n                <CameraController playground={playground} setChatVisible={setChatVisible} chatVisible={chatVisible} />\n                <fog attach=\"fog\" args={[0x778899, 1000, 4000]} />\n                <ambientLight args={[0x666666]} />\n                <directionalLight\n                    args={[0xffffff, 7]}\n                    position={[0, 6000, 3000]}\n                    shadow-camera-left={-1000}\n                    shadow-camera-bottom={-1000}\n                    shadow-camera-right={1000}\n                    shadow-camera-top={1000}\n                    shadow-camera-near={1}\n                    shadow-camera-far={12000}\n                    shadow-mapSize-width={1024}\n                    shadow-mapSize-height={1024}\n                    castShadow\n                />\n\n                {players.map(player => <Player key={player.id} player={player} messages={player.visibleMessages} />)}\n\n                <mesh receiveShadow \n                    rotation-x={- Math.PI / 2} \n                    onPointerMove={e => (\n                        playground.getLocalPlayer().target = e.point\n                    )}\n                >\n                    <planeBufferGeometry attach=\"geometry\" args={[16000, 16000]} />\n                    <meshLambertMaterial attach=\"material\">\n                        <primitive attach=\"map\" object={grassTexture} repeat={[64, 64]} wrapS={THREE.RepeatWrapping} wrapT={THREE.RepeatWrapping} encoding={THREE.sRGBEncoding} />\n                    </meshLambertMaterial>\n                </mesh>\n            </Canvas>\n            {playground && chatVisible &&\n                <ChatWindow sendChatMessage={playground.sendChatMessage.bind(playground)} messages={messages} hideChat={() => setChatVisible(false)}/>\n            }\n        </div>\n    )\n}\n\nexport default MainCanvas","import React, {useState} from 'react';\nimport './LoginPrompt.css'\nimport {FormGroup, InputGroup, Button} from '@blueprintjs/core'\nimport Player from '../PlayerData'\n\nfunction LoginPrompt({logIn}) {\n    const [name, setName] = useState(\"\")\n\n    const handleTextChange = e => {\n        const text = e.target.value || \"\"\n        setName(text)\n    }\n\n    const handleKeyPress = e => e.which === 13 ? logIn(Player.create(name)) : \"\"\n\n    return (\n        <div className=\"login-container bp3-light\">\n            <FormGroup\n                label=\"Choose a name to use:\"\n            >\n                <InputGroup autoFocus placeholder=\"name...\" large onChange={handleTextChange} onKeyDown={handleKeyPress}/>\n            </FormGroup>\n\n            <Button onClick={() => {\n                logIn(Player.create(name))\n            }}>Join</Button>\n        </div>\n    )\n}\n\nexport default LoginPrompt","import React, {useState, useEffect} from 'react';\nimport MainCanvas from './MainCanvas'\nimport LoginPrompt from './components/LoginPrompt'\nimport Player from './PlayerData'\nimport './App.css';\n\nconst QUICK_START = false\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = useState(false)\n  const [player, setPlayer] = useState(null)\n\n  const doLogin = (player) => {\n        setPlayer(player)\n        setLoggedIn(true)\n  }\n\n  useEffect(() => {\n      if (QUICK_START)\n          doLogin(Player.create())\n  }, [])\n\n  return (\n    <div className=\"App bp3-dark\">\n\n        {player &&\n          <MainCanvas player={player}/>\n        }\n\n        <div className=\"screen-container\">\n              {!loggedIn &&\n                  <LoginPrompt logIn={doLogin} />\n              }\n        </div>\n      \n      {/* This is for webcam capture/display stuff */}\n      {/* <canvas id=\"test-canvas\"></canvas>\n      <video id=\"video\" style={{ visibility: \"hidden\"}}></video> */}\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}