(this["webpackJsonpextrude-client"]=this["webpackJsonpextrude-client"]||[]).push([[0],{148:function(e,t,a){e.exports=a(222)},152:function(e,t,a){},182:function(e,t){},191:function(e,t,a){},192:function(e,t,a){},219:function(e,t,a){},220:function(e,t,a){},221:function(e,t,a){},222:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),s=a.n(o),c=(a(152),a(3)),i=a(2),l=a(13),u=a(1),p=a(79),d=a(10),h=a(12),m=a(16),y=a(80),v=a.n(y),f=a(15),g=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"randString",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"computeCompositeBoundingBox",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];e.walkNodes(t,(function(e){e.geometry&&((!a.excludedTypes||!a.excludedTypes.includes(e.userData.objectType))&&n.push(e))}));var r=new u.Box3;return n.forEach((function(e){e.updateMatrixWorld();var t=e.geometry.clone();t.applyMatrix(e.matrixWorld),t.computeBoundingBox(),r=r.union(t.boundingBox)})),r}},{key:"walkNodes",value:function(t,a){a(t);for(var n=0;n<t.children.length;n+=1)e.walkNodes(t.children[n],a)}},{key:"rand",value:function(e,t){return Math.random()*(t-e)+e}},{key:"vec3ToScreenPoint",value:function(e,t,a,n){var r=e.clone(),o=.5*a,s=.5*n;return r.project(t),r.x=r.x*o+o,r.y=-r.y*s+s,{x:r.x,y:r.y}}},{key:"exponentialEaseOut",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"centroid",value:function(e){var t=e.length;return e.reduce((function(e,a,n){return e.x+=a.x,e.y+=a.y,e.z+=a.z,n===t-1&&(e.x/=t,e.y/=t,e.z/=t),e}),new u.Vector3(0,0,0))}},{key:"pointsAreEqual3D",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.001;return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))<a}},{key:"generateId",value:function(){return""+Math.round(1e6*Math.random())}}]),e}(),b=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.randString(g.rand(3,12));return{name:e,id:g.generateId(),position:new u.Vector3(g.rand(-100,100),0,g.rand(-100,100)),visibleMessages:[],keyStates:{},target:new u.Vector3,skindex:5003*e.length%13}}},{key:"addMessage",value:function(e,t){return Object(l.a)({},e,{visibleMessages:[].concat(Object(f.a)(e.visibleMessages),[t])})}},{key:"removeOldestMessage",value:function(e){var t=e.visibleMessages.slice();return t.shift(),Object(l.a)({},e,{visibleMessages:t})}}]),e}(),O=a(227),E=function(){function e(t,a,n){Object(h.a)(this,e),this.socket=null,this.state={players:{}},this.messages=[],this.localPlayerId=t.id,this.updatePlayers=a,this.updateMessagesFunc=n,this.state.players[t.id]=t,this.connectToServer(t)}return Object(m.a)(e,[{key:"connectToServer",value:function(e){var t=this;this.socket=v()("https://nameless-depths-23573.herokuapp.com"),this.socket.emit("event",{type:"player_enter_request",player:e}),this.socket.on("event",(function(e){t.handleServerEvent(e)})),this.socket.on("disconnect",(function(a){t.handleServerEvent({type:"player_exit",player:e})})),this.socket.on("reconnect",(function(a){t.socket.emit("event",{type:"player_enter_request",player:e})})),this.sendMouseMove=Object(O.a)((function(){return t.socket.emit("event",{type:"player_target_change",playerId:t.localPlayerId,target:t.getLocalPlayer().target})}),1e3),this.periodicSyncInterval=setInterval((function(){t.socket.emit("event",{type:"player_sync",player:t.getLocalPlayer()})}),2e3)}},{key:"handleServerEvent",value:function(e){var t,a=this;switch(e.playerId&&(t=this.state.players[e.playerId]),e.type){case"player_enter":console.log("player_enter: ",e.player),this.state.players[e.player.id]=e.player,this.updatePlayers(this.getPlayersArray());break;case"player_exit":console.log("player_exit: ",e.player),this.state.players[e.player.id]&&e.player.id!==this.localPlayerId&&(delete this.state.players[e.player.id],this.updatePlayers(this.getPlayersArray()));break;case"full_state_request":this.socket.emit("event",{type:"full_state_response",state:this.state});break;case"full_state_update":this.state=e.state,this.updatePlayers(this.getPlayersArray());break;case"input_key_down":this.serverKeyDown(e);break;case"input_key_up":this.serverKeyUp(e);break;case"input_mouse_move":case"input_click":break;case"chat_message":if(e.playerId&&!this.state.players[e.playerId])break;var n=Object(l.a)({},e,{player:t}),r=5e3+1e3*Math.floor(n.message.length/100);this.state.players=Object(l.a)({},this.state.players,Object(i.a)({},e.playerId,b.addMessage(t,n))),setTimeout((function(){a.state.players=Object(l.a)({},a.state.players,Object(i.a)({},e.playerId,b.removeOldestMessage(a.state.players[e.playerId]))),a.updatePlayers(Object.values(a.state.players))}),r),this.messages=this.messages.concat(n),this.updateMessagesFunc(this.messages),this.updatePlayers(Object.values(this.state.players));break;case"player_target_change":if(e.playerId&&!this.state.players[e.playerId])break;this.state.players=Object(l.a)({},this.state.players,Object(i.a)({},e.playerId,Object(l.a)({},t,{target:e.target}))),this.updatePlayers(Object.values(this.state.players));break;case"player_sync":if(e.player.id===this.localPlayerId)break;this.state.players[e.player.id]=e.player,this.updatePlayers(Object.values(this.state.players));break;default:console.log("unrecognized server event: ",e)}}},{key:"getPlayersArray",value:function(){var e=this;return Object.keys(this.state.players).map((function(t){return e.state.players[t]}))}},{key:"serverKeyDown",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!0}}},{key:"serverKeyUp",value:function(e){if(e.playerId!==this.localPlayerId){var t=e.key;this.state.players[e.playerId].keyStates[t]=!1}}},{key:"localKeyDown",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!0,this.socket.emit("event",{type:"input_key_down",playerId:this.localPlayerId,key:a}))}},{key:"localKeyUp",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&(this.state.players[this.localPlayerId].keyStates[a]=!1,this.socket.emit("event",{type:"input_key_up",playerId:this.localPlayerId,key:a}))}},{key:"localMouseMove",value:function(e){this.sendMouseMove()}},{key:"localClick",value:function(e){this.socket.emit("event",{type:"input_click",playerId:this.localPlayerId})}},{key:"sendChatMessage",value:function(e){this.socket.emit("event",{type:"chat_message",message:e,playerId:this.localPlayerId,time:new Date})}},{key:"getLocalPlayer",value:function(){return this.state.players[this.localPlayerId]}}]),e}();E.RECOGNIZED_KEYS=["a","w","s","d","f","e","q"," ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],E.KEY_TO_DIRECTION={a:"left",w:"up",s:"down",d:"right"};var k=E,w=function e(){Object(h.a)(this,e)};w.MODE_DEFAULT="default",w.MODE_MENU="menu",w.MODE_EXTRUDE="extrude",w.MODE_MATERIALS="materials",w.STRUCTURE_MODE_EXTRUDE="structure_extrude";var j=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"listenFor",value:function(t,a,n){a.includedMeshes=n,e.eventMaps[t]=a}},{key:"removeListener",value:function(t){delete e.eventMaps[t]}},{key:"eventOccurred",value:function(t,a){Object.values(e.eventMaps).forEach((function(e){(!e.includedMeshes||e.includedMeshes.includes(a.object.id))&&e[t]&&e[t](a)}))}}]),e}();j.MOUSE_MOVE="mouse_move",j.CLICK="click",j.POINTER_OUT="pointer_out",j.POINTER_OVER="pointer_over",j.eventMaps={};var M=j,S=a(39),x=a(19),_=a(26);var P=a(51),D=a.n(P),I=a(86),T=a(54),C={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,moveUp:!1,moveDown:!1,crouch:!1,jump:!1,attack:!1},R=function(){function e(){Object(h.a)(this,e)}return Object(m.a)(e,null,[{key:"init",value:function(){var e=this,t={baseUrl:"models/ogro/",body:"ogro.md2",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png","sharokh.png"],weapons:[["weapon.md2","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:1e3,crouchSpeed:175};this.skinCount=t.skins.length,this.base=new T.a,this.base.scale=1,this.basePromise=new Promise((function(t,a){e.base.onLoadComplete=function(){e.base.enableShadows(!0),e.base.setSkin(2),t(e.base)}})),this.base.loadParts(t)}},{key:"customizeMovement",value:function(e){var t;e.updateMovementModel=(t=e,function(e){var a=t.controls;t.decceleration=1500,t.maxSpeed=t.walkSpeed,t.moveDirection||(t.moveDirection=new u.Vector3);var n=a.moveForward?1:0,r=a.moveBackward?-1:0,o=a.moveRight?-1:0,s=a.moveLeft?1:0,c=a.moveUp?1:0,i=a.moveDown?-1:0;t.impulseDirection=new u.Vector3(o+s,c+i,n+r),t.impulseDirection.normalize();var l=new u.Vector3(0,0,1).applyAxisAngle(new u.Vector3(0,1,0),t.bodyOrientation),p=new u.Vector3(t.target.x,t.target.y,t.target.z).clone().sub(t.root.position).normalize();p.y=0;var d=l.cross(p).y;if(t.bodyOrientation+=d*e*10,t.impulseDirection.applyAxisAngle(new u.Vector3(0,1,0),t.bodyOrientation),t.impulseDirection.length()>0&&t.moveDirection.copy(t.impulseDirection),Math.abs(d)>.2&&(t.speed=d*e*10,d<0?a.moveLeft=!0:a.moveRight=!0),t.impulseDirection.length()>0)t.speed=t.maxSpeed;else{var h=g.exponentialEaseOut(t.speed/t.maxSpeed);t.speed=u.MathUtils.clamp(t.speed-h*e*t.decceleration,0,t.maxSpeed)}var m=t.moveDirection.clone().multiplyScalar(t.speed*e/10);t.root.position.add(m),t.root.rotation.y=t.bodyOrientation})}},{key:"getModelInstance",value:function(){var e=Object(I.a)(D.a.mark((function e(){var t,a,n=arguments;return D.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.instanceIndex,this.instanceIndex=(this.instanceIndex+1)%this.skinCount,(a=new T.a).scale=1,a.controls=this.getControlsCopy(),a.id=Math.random(),this.customizeMovement(a),e.next=9,this.basePromise.then((function(e){return a.shareParts(e),a.enableShadows(!0),a.setSkin(t),a.target=new u.Vector3,a.setWeapon(0),a}));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getControlsCopy",value:function(){var e={};return Object.keys(C).forEach((function(t){return e[t]=C[t]})),e}}]),e}();R.instanceIndex=2,R.init();var U=R;a(191);var z=function(e){var t=e.player,a=e.messages,o=(e.mode,Object(n.useState)(null)),s=Object(c.a)(o,2),i=s[0],l=s[1],p=Object(n.useState)(0),h=Object(c.a)(p,2),m=h[0],y=h[1],v=Object(n.useState)(null),f=Object(c.a)(v,2),b=f[0],O=f[1],E=Object(d.e)().size;return function(e,t){var a=Object(d.e)(),r=a.scene,o=a.size,s=a.camera,i=Object(n.useState)(null),l=Object(c.a)(i,2);l[0],l[1],Object(d.d)((function(){var a=e.map((function(e){return document.querySelector(e)})),n=[];t.forEach((function(e){r.traverse((function(t){t.userData.name===e&&n.push(t)}))})),a.length===n.length&&a.forEach((function(e,t){var a=n[t],r=new u.Vector3;a.getWorldPosition(r);var c=g.vec3ToScreenPoint(r,s,o.width,o.height);e.style.position="absolute",e.style.zIndex="10000",e.style.transform="translateX(-50%)",e.style.left=c.x+"px",e.style.top=c.y+"px"}))}))}(["#player-label-"+t.id],["md2-root-"+t.id]),Object(n.useEffect)((function(){var e=document.createElement("div");e.id="player-label-"+t.id,e.innerText=t.name,document.getElementsByClassName("App")[0].appendChild(e)}),[]),Object(n.useEffect)((function(){U.getModelInstance(t.skindex).then((function(e){var a=g.computeCompositeBoundingBox(e.root);e.root.userData.name="md2-root-"+t.id,y(a.getSize().y),l(e),e.root.position.set(t.position.x,e.root.position.y,t.position.z);var n=new _.a;n.setPositions([0,0,0,0,0,100]);var r=new x.a({color:6749969,linewidth:2,vertexColors:!1,dashed:!1,resolution:new u.Vector2(E.width,E.height)}),o=new S.a(n,r);e.root.add(o),O(o)}))}),[]),Object(d.d)((function(e,a){if(i){i.controls.moveForward=t.keyStates.w||t.keyStates.ArrowUp,i.controls.moveBackward=t.keyStates.s||t.keyStates.ArrowDown,i.controls.moveLeft=t.keyStates.a||t.keyStates.ArrowLeft,i.controls.moveRight=t.keyStates.d||t.keyStates.ArrowRight,i.controls.moveUp=t.keyStates.q,i.controls.moveDown=t.keyStates.e,i.controls.jump=t.keyStates[" "],i.controls.attack=t.keyStates.f,i.update(1.75*a),t.position.x=i.root.position.x,t.position.y=i.root.position.y,t.position.z=i.root.position.z,i.target=t.target;var n=new u.Vector3(t.position.x,t.position.y,t.position.z),r=new u.Vector3(i.target.x,i.target.y,i.target.z);r.sub(n),b.rotation.y=-i.bodyOrientation,b.geometry.setPositions([0,20,5,r.x,r.y,r.z]),b.geometry.needsUpdate=!0}})),r.a.createElement("mesh",null,i&&r.a.createElement(r.a.Fragment,null,r.a.createElement("primitive",{object:i.root,onClick:function(e){return console.log("click")}}),a.map((function(e,a){return r.a.createElement(d.b,{key:e.time,center:!0,position:[t.position.x,t.position.y+m/1.5,t.position.z]},r.a.createElement("div",{style:{transform:"translateY(".concat(2.1*-a,"rem)")},className:"speech-bubble"},e.message))}))))};Object(d.c)({LineMaterial:x.a,LineGeometry:_.a,Line2:S.a});var A=function(e){e.player;var t=e.finishStructureFunc,a=Object(n.useState)([]),o=Object(c.a)(a,2),s=o[0],l=o[1],p=Object(n.useState)(null),h=Object(c.a)(p,2),m=h[0],y=h[1],v=Object(n.useState)(!1),b=Object(c.a)(v,2),O=b[0],E=b[1],k=Object(d.e)().size;Object(n.useEffect)((function(){var e;return M.listenFor("partial_structure",(e={},Object(i.a)(e,M.MOUSE_MOVE,(function(e){if(s.length>0){var t=new u.Vector3(e.point.x,e.point.y,e.point.z);y(t)}})),Object(i.a)(e,M.CLICK,(function(e){if(!e.shiftKey){var a=new u.Vector3(e.point.x,e.point.y,e.point.z),n=!1;if(s.length>2){var r=a.clone().sub(s[0]);r.length()<30&&(a.add(r),n=!0)}if(l([].concat(Object(f.a)(s),[a])),n){var o=e.object.rotation.clone(),c=e.face.normal.clone().applyEuler(o),i={id:g.generateId(),points:s,normal:c,extrusionParams:{depth:4,row:0,theta:0,bevelThickness:3,bevelSize:4,bevelSegments:4,steps:1}};t(i),l([]),E(!1),y(null)}}})),e)),function(){M.removeListener("partial_structure")}}),[s]);var w=Object(d.f)((function(e){if(s.length<1||null===m)e.setPositions(new Float32Array(150));else{var a=m.clone();if(s.length>2){var n=s[0].clone().sub(m);n.length()<30?(a.add(n),E(!0)):E(!1),s[0].clone().sub(s[s.length-1]).length()<.1&&(t(s),l([]),E(!1),y(null))}var r=s.reduce((function(e,t){var a=t.x,n=t.y,r=t.z;return[].concat(Object(f.a)(e),[a,n,r])}),[],[]);for(r.push(a.x,a.y,a.z);r.length<150;)r.push(r[r.length-3],r[r.length-2],r[r.length-1]);r.length=Math.min(150,r.length),e.setPositions(r)}}),[s,m]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("line2",null,r.a.createElement("lineGeometry",{attach:"geometry",ref:w}),r.a.createElement("lineMaterial",{attach:"material",color:6749969,linewidth:10,resolution:[k.width,k.height]})),s.map((function(e,t){return r.a.createElement("mesh",{key:e.x+e.y+e.z+"",castShadow:!0,position:[e.x,e.y,e.z]},r.a.createElement("sphereGeometry",{attach:"geometry",args:[0===t&&O?30:7,32,32]}),r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0===t&&O?65280:1144576,clearcoat:!0,metalness:.25,clearcoatRoughness:.75,roughness:.1}))})))};var V=function(e){var t=e.structure,a=e.updateStructure,o=e.active,s=(e.player,e.onPointerMove),l=e.onClick,p=e.onPointerOut,d=e.mode,h=e.setMode,m=(e.mouseTravel,Object(n.useState)(null)),y=Object(c.a)(m,2),v=y[0],f=y[1],b=Object(n.useState)(!1),O=Object(c.a)(b,2),E=O[0],k=O[1],j=Object(n.useState)(null),S=Object(c.a)(j,2),x=(S[0],S[1],Object(n.useState)(new u.Vector3)),_=Object(c.a)(x,2),P=_[0],D=_[1],I=Object(n.useRef)();Object(n.useEffect)((function(){var e=g.centroid(t.points),a=t.normal,n=new u.Vector3(0,0,1),r=new u.Quaternion;r.setFromUnitVectors(a,n);var o=t.points.map((function(t){return new u.Vector3(t.x-e.x,t.y-e.y,t.z-e.z)})).map((function(e){return e.clone().applyQuaternion(r)}));f(new u.Shape(o.map((function(e){return new u.Vector2(e.x,e.y)})))),D(e)}),[t.points]),Object(n.useEffect)((function(){var e,n=function(e){if(e.shiftKey){var a=e.face.a;a>=0&&a<=6*(t.points.length-2)?k(!0):k(!1)}else k(!1)};I.current&&M.listenFor("structure_"+t.id,(e={},Object(i.a)(e,M.MOUSE_MOVE,n),Object(i.a)(e,M.CLICK,(function(e){d===w.MODE_DEFAULT?e.shiftKey&&h(w.MODE_EXTRUDE,t.id):o&&d===w.MODE_EXTRUDE&&a(t)})),Object(i.a)(e,M.POINTER_OUT,(function(e){k(!1)})),Object(i.a)(e,M.POINTER_OVER,n),e),[I.current.id])}),[I.current,E,t,d,o]);var T=o&&d===w.MODE_EXTRUDE,C=v&&E&&d===w.MODE_DEFAULT;return r.a.createElement(r.a.Fragment,null,v&&r.a.createElement("mesh",{ref:I,quaternion:R(t.normal),position:P,castShadow:!0,receiveShadow:!0,onPointerMove:s,onClick:l,onPointerOut:p},r.a.createElement("extrudeGeometry",{attach:"geometry",args:[v,t.extrusionParams]}),T&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:65280,emissiveIntensity:.7,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25}),!T&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emmissive:65280,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25})),v&&d!==w.MODE_EXTRUDE&&r.a.createElement("mesh",{quaternion:R(t.normal),position:function(e,t,a){return e.clone().addScaledVector(t,a+1.5)}(P,t.normal,t.extrusionParams.depth)},r.a.createElement("extrudeBufferGeometry",{attach:"geometry",args:[v,{depth:1,bevelSize:1,bevelThickness:1,bevelSegments:2}]}),C&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:13277,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25}),!C&&r.a.createElement("meshPhysicalMaterial",{attach:"material",color:0,emissive:13277,emissiveIntensity:.05,metalness:.9,roughness:.1,clearcoat:!0,clearcoatRoughness:.25})));function R(e){var t=new u.Quaternion;return t.setFromUnitVectors(new u.Vector3(0,0,1),e),t}},L=(a(192),a(226));var F=function(e){var t=e.sendChatMessage,a=e.messages,o=e.hideChat,s=Object(n.useState)(""),i=Object(c.a)(s,2),l=i[0],u=i[1],p=Object(n.useRef)();return Object(n.useEffect)((function(){p.current.scrollTop=p.current.scrollHeight}),[a]),r.a.createElement("div",{className:"ChatWindow"},r.a.createElement("div",{className:"all-messages",ref:p},a.map((function(e){return r.a.createElement("div",{className:"chat-message",key:e.time},r.a.createElement("div",{className:"chat-message-name"},e.player.name,":"),r.a.createElement("div",{className:"chat-message-content"},e.message))}))),r.a.createElement(L.c,{className:"your-message",placeholder:"your message...",large:!0,onKeyDown:function(e){13===e.which?(t(l),u("")):27===e.which&&o()},value:l,onChange:function(e){return u(e.target.value)},autoFocus:!0}))},N=a(91),K=a(90),B=a(92),X=a(93);a(219);Object(d.c)({EffectComposer:N.a,RenderPass:K.a,UnrealBloomPass:X.a,SSAOPass:B.a});var G=new p.a,q=new u.Vector3(0,100,100),W=new u.Vector3(0,0,0),Y=new u.Vector3,J=1,Q=function(e){var t=e.playground,a=e.mode,n=Object(d.e)(),r=n.camera;n.scene;return Object(d.d)((function(){if(G.update(),a===w.MODE_DEFAULT){var e=t.getLocalPlayer().position,n=t.getLocalPlayer().target,o=new u.Vector3(e.x,e.y,e.z),s=o.set(o.x,o.y+70,o.z),c=new u.Vector3(n.x,n.y,n.z).clone().sub(s).normalize().clone().multiplyScalar(-200*J);c.z=Math.max(Math.abs(c.z),50)*Math.sign(c.z),c.y=Math.max(c.y,50),q.copy(o.clone().add(c)),W.copy(o);var i=u.MathUtils.clamp(r.position.clone().sub(q).length()/10,.1,4);r.position.copy(r.position.lerp(q,.005*i));var l=Y.lerp(W,.05).clone();r.lookAt(l),r.updateProjectionMatrix(),Y.copy(l)}})),null};function Z(e){var t=e.ssao,a=e.bloom,o=Object(d.e)(),s=o.gl,c=o.scene,i=o.camera,l=o.size,u=Object(n.useRef)();return Object(n.useEffect)((function(){u.current.setSize(l.width,l.height)}),[l]),Object(d.d)((function(){return u.current.render()}),1),r.a.createElement("effectComposer",{ref:u,args:[s]},r.a.createElement("renderPass",{attachArray:"passes",args:[c,i]}),a&&r.a.createElement("unrealBloomPass",{attachArray:"passes",args:[void 0,1.5,.4,.6],bloomThreshold:1,bloomStrength:1,bloomRadius:0}),t&&r.a.createElement("sSAOPass",{attachArray:"passes",args:[c,i,l.width,l.height],kernelRadius:16,minDistance:.005,maxDistance:50}))}function H(e){var t=e.mode,a=e.setMode,r=e.playground,o=e.structures,s=e.setStructures,c=e.chatVisible,u=e.setChatVisible,p=e.activeObjectId,h=(e.setActiveObjectId,e.mouseTravel),m=e.setMouseTravel,y=Object(d.e)(),v=y.gl;y.size;return Object(n.useEffect)((function(){v.domElement.onclick=function(e){switch(t){case w.MODE_DEFAULT:u(!1),r&&r.localClick(e);break;case w.MODE_EXTRUDE:a(w.MODE_DEFAULT)}},window.onkeydown=function(e){"9"===e.key&&(c||e.preventDefault(),u(!c)),r&&!c&&r.localKeyDown(e)},window.onkeyup=function(e){r&&r.localKeyUp(e)},v.domElement.onmousemove=function(e){switch(t){case w.MODE_DEFAULT:r&&r.localMouseMove(e);break;case w.MODE_EXTRUDE:m({x:h.x+e.movementX,y:h.y+e.movementY})}},v.domElement.onwheel=function(e){switch(t){case w.MODE_DEFAULT:e.preventDefault(),J+=.01*e.deltaY,J=Math.min(Math.max(.05,J),3);break;case w.MODE_EXTRUDE:var a=o[p],n=Math.max(0,a.extrusionParams.depth+e.deltaY);s(Object(l.a)({},o,Object(i.a)({},a.id,Object(l.a)({},a,{extrusionParams:Object(l.a)({},a.extrusionParams,{depth:n})}))))}}}),[v,r,c,t,p,o,h]),null}var $=function(e){var t=e.player,a=Object(n.useState)([]),o=Object(c.a)(a,2),s=o[0],p=o[1],h=Object(n.useState)([]),m=Object(c.a)(h,2),y=m[0],v=m[1],f=Object(n.useState)(null),g=Object(c.a)(f,2),b=g[0],O=g[1],E=Object(n.useState)(!1),j=Object(c.a)(E,2),S=j[0],x=j[1],_=Object(n.useState)({}),P=Object(c.a)(_,2),D=P[0],I=P[1],T=Object(n.useState)(null),C=Object(c.a)(T,2),R=C[0],U=C[1],L=Object(n.useState)({x:0,y:0}),N=Object(c.a)(L,2),K=N[0],B=N[1],X=Object(n.useMemo)((function(){return(new u.TextureLoader).load("rust2.jpg")}),[]),G=Object(n.useState)(w.MODE_DEFAULT),q=Object(c.a)(G,2),W=q[0],Y=q[1];Object(n.useEffect)((function(){O(new k(t,(function(e){return p(e)}),(function(e){return v(e)})))}),[t]);var J=function(e){e.stopPropagation(),b.getLocalPlayer().target=e.point,t.target=e.point,M.eventOccurred(M.MOUSE_MOVE,e)},$=function(e){e.stopPropagation(),M.eventOccurred(M.CLICK,e)},ee=function(e){M.eventOccurred(M.POINTER_OUT,e)},te=function(e){M.eventOccurred(M.POINTER_OVER,e)},ae=function(e){I(Object(l.a)({},D,Object(i.a)({},e.id,e))),U(null),B({x:0,y:0}),Y(w.MODE_DEFAULT)};return r.a.createElement("div",{className:"main-canvas-container"},r.a.createElement(d.a,{style:{backgroundColor:"#789"},gl:{antialias:!1,alpha:!1},pixelRatio:window.devicePixelRatio,camera:{position:[0,10,10],near:1,far:4e3},shadowMap:!0,onCreated:function(e){var t=e.gl;t.toneMapping=u.Uncharted2ToneMapping,t.outputEncoding=u.sRGBEncoding,t.shadowMap.type=u.PCFSoftShadowMap,t.setClearColor(new u.Color("#667788"))}},r.a.createElement(Z,null),r.a.createElement(H,{mode:W,setMode:Y,playground:b,structures:D,setStructures:I,chatVisible:S,setChatVisible:x,activeObjectId:R,setActiveObjectId:U,mouseTravel:K,setMouseTravel:B}),r.a.createElement(Q,{playground:b,mode:W}),r.a.createElement("fog",{attach:"fog",args:[6715272,500,1500]}),r.a.createElement("ambientLight",{args:[6710886]}),r.a.createElement("directionalLight",{args:[16777215,7],position:[0,6e3,3e3],"shadow-camera-left":-1e3,"shadow-camera-bottom":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-near":1,"shadow-camera-far":12e3,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,castShadow:!0}),s.map((function(e){return r.a.createElement(z,{key:e.id,player:e,mode:W,messages:e.visibleMessages})})),W===w.MODE_DEFAULT&&r.a.createElement(A,{player:t,finishStructureFunc:function(e){I(Object(l.a)({},D,Object(i.a)({},e.id,e))),Y(w.MODE_EXTRUDE),U(e.id)}}),Object.values(D).map((function(e){return r.a.createElement(V,{key:e.id,structure:e,updateStructure:ae,player:b.getLocalPlayer(),onPointerMove:J,onClick:$,onPointerOut:ee,onPointerOver:te,mode:W,active:R===e.id,setMode:function(e,t){Y(e),t&&U(t)},mouseTravel:K})})),r.a.createElement("mesh",{receiveShadow:!0,"rotation-x":-Math.PI/2,onPointerMove:J,onClick:$},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[16e3,16e3]}),r.a.createElement("meshStandardMaterial",{attach:"material",color:3355443,roughness:.55,metalness:.8},r.a.createElement("primitive",{attach:"map",object:X,repeat:[64,64],wrapS:u.RepeatWrapping,wrapT:u.RepeatWrapping,encoding:u.sRGBEncoding})))),b&&S&&r.a.createElement(F,{sendChatMessage:b.sendChatMessage.bind(b),messages:y,hideChat:function(){return x(!1)}}))};a(220);var ee=function(e){var t=e.logIn,a=Object(n.useState)(""),o=Object(c.a)(a,2),s=o[0],i=o[1];return r.a.createElement("div",{className:"login-container bp3-light"},r.a.createElement(L.b,{label:"Choose a name to use:"},r.a.createElement(L.c,{autoFocus:!0,placeholder:"name...",large:!0,onChange:function(e){var t=e.target.value||"";i(t)},onKeyDown:function(e){return 13===e.which?t(b.create(s)):""}})),r.a.createElement(L.a,{onClick:function(){t(b.create(s))}},"Join"))};a(221);var te=function(){var e=Object(n.useState)(!1),t=Object(c.a)(e,2),a=t[0],o=t[1],s=Object(n.useState)(null),i=Object(c.a)(s,2),l=i[0],u=i[1],p=function(e){u(e),o(!0)};return Object(n.useEffect)((function(){0}),[]),r.a.createElement("div",{className:"App bp3-dark"},l&&r.a.createElement($,{player:l}),r.a.createElement("div",{className:"screen-container"},!a&&r.a.createElement(ee,{logIn:p})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[148,1,2]]]);
//# sourceMappingURL=main.95b69e29.chunk.js.map