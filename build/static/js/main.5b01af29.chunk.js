(this["webpackJsonpextrude-client"]=this["webpackJsonpextrude-client"]||[]).push([[0],{136:function(e,t,a){e.exports=a(208)},140:function(e,t,a){},170:function(e,t){},179:function(e,t,a){},180:function(e,t,a){},207:function(e,t,a){},208:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(9),i=a.n(o),s=(a(140),a(4)),c=a(1),l=a(73),u=a(43),p=a(16),h=a(10),d=a(12),y=a(74),m=a.n(y),v=function(){function e(){Object(h.a)(this,e),this.root=new c.Object3D}return Object(d.a)(e,[{key:"startPlayerMovement",value:function(e,t){}},{key:"stopPlayerMovement",value:function(e,t){}}]),e}(),g=function(){function e(t,a){Object(h.a)(this,e),this.player=null,this.socket=null,this.renderer=new v,this.state={players:{}},this.player=t,this.setPlayers=a,this.connectToServer(this.player)}return Object(d.a)(e,[{key:"connectToServer",value:function(e){var t=this;this.socket=m()("https://nameless-depths-23573.herokuapp.com"),this.socket.emit("event",{type:"player_enter_request",player:e}),this.socket.on("event",(function(e){console.log("server event: ",e),t.handleServerEvent(e)}))}},{key:"handleServerEvent",value:function(e){switch(e.type){case"player_enter":console.log("player_enter: ",e.player),this.state.players[e.player.id]=e.player,this.setPlayers(this.getPlayersArray());break;case"player_exit":delete this.state.players[e.player.id],this.setPlayers(this.getPlayersArray());break;case"full_state_request":this.socket.emit("event",{type:"full_state_response",state:this.state});break;case"full_state_update":this.state=e.state,this.setPlayers(this.getPlayersArray());break;case"input_key_down":this.serverKeyDown(e);break;case"input_key_up":this.serverKeyUp(e);break;case"input_mouse_move":case"input_click":break;default:console.log("unrecognized server event: ",e)}}},{key:"getPlayersArray",value:function(){var e=this;return Object.keys(this.state.players).map((function(t){return e.state.players[t]}))}},{key:"serverKeyDown",value:function(t){this.renderer.startPlayerMovement(t.playerId,e.KEY_TO_DIRECTION[t.key])}},{key:"serverKeyUp",value:function(t){this.renderer.stopPlayerMovement(t.playerId,e.KEY_TO_DIRECTION[t.key])}},{key:"localKeyDown",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&this.socket.emit("event",{type:"input_key_down",playerId:this.player.id,key:a})}},{key:"localKeyUp",value:function(t){var a=t.key;e.RECOGNIZED_KEYS.includes(a)&&this.socket.emit("event",{type:"input_key_up",playerId:this.player.id,key:a})}},{key:"localMouseMove",value:function(e){this.socket.emit("event",{type:"input_mouse_move",playerId:this.player.id})}},{key:"localClick",value:function(e){this.socket.emit("event",{type:"input_click",playerId:this.player.id})}}]),e}();g.RECOGNIZED_KEYS=["a","w","s","d"],g.KEY_TO_DIRECTION={a:"left",w:"up",s:"down",d:"right"};var f=g,k=a(44),b=a.n(k),w=a(75),E=a(48),O={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1,crouch:!1,jump:!1,attack:!1},j=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"init",value:function(){var e=this,t={baseUrl:"models/ogro/",body:"ogro.md2",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png","sharokh.png"],weapons:[["weapon.md2","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:350,crouchSpeed:175};this.skinCount=t.skins.length,this.base=new E.a,this.base.scale=4,this.basePromise=new Promise((function(t,a){e.base.onLoadComplete=function(){e.base.enableShadows(!0),e.base.setWeapon(0),e.base.setSkin(2),t(e.base)}})),this.base.loadParts(t)}},{key:"getInstance",value:function(){var e=Object(w.a)(b.a.mark((function e(){var t,a,n=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:this.instanceIndex+=2%this.skinCount,(a=new E.a).scale=4,a.controls=this.getControlsCopy(),a.id=Math.random(),e.next=7,this.basePromise.then((function(e){return a.shareParts(e),a.enableShadows(!0),a.setWeapon(0),a.setSkin(t),a}));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getControlsCopy",value:function(){var e={};return Object.keys(O).forEach((function(t){return e[t]=O[t]})),e}}]),e}();j.instanceIndex=1,j.init();var _=j,S=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"randString",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=a.length,r=0;r<e;r++)t+=a.charAt(Math.floor(Math.random()*n));return t}},{key:"computeCompositeBoundingBox",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];e.walkNodes(t,(function(e){e.geometry&&((!a.excludedTypes||!a.excludedTypes.includes(e.userData.objectType))&&n.push(e))}));var r=new c.Box3;return n.forEach((function(e){e.updateMatrixWorld();var t=e.geometry.clone();t.applyMatrix(e.matrixWorld),t.computeBoundingBox(),r=r.union(t.boundingBox)})),r}},{key:"walkNodes",value:function(t,a){a(t);for(var n=0;n<t.children.length;n+=1)e.walkNodes(t.children[n],a)}},{key:"rand",value:function(e,t){return Math.random()*(t-e)+e}}]),e}();new c.Clock;var M=function(e){var t=e.player,a=Object(n.useState)(null),o=Object(s.a)(a,2),i=o[0],c=o[1],l=Object(n.useState)(0),u=Object(s.a)(l,2),h=u[0],d=u[1];return Object(n.useMemo)((function(){_.getInstance().then((function(e){var t=S.computeCompositeBoundingBox(e.root);d(t.getSize().y),c(e)}))}),[]),Object(p.c)((function(e){i.root.position.set(t.position.x,h/2-15,t.position.z),i.update(.012)})),r.a.createElement("mesh",null,i&&r.a.createElement("primitive",{object:i.root}))};a(179);Object(p.b)({OrbitControls:u.a});var C=new l.a,I=function(){var e=Object(p.d)(),t=e.camera,a=e.gl;return Object(p.e)((function(){return C.update()})),Object(n.useEffect)((function(){a.domElement.appendChild(C.dom);var e=new u.a(t,a.domElement);return e.target.set(0,50,0),function(){e.dispose()}}),[t,a]),null};var P=function e(t){var a=t.player,o=Object(n.useState)([]),i=Object(s.a)(o,2),l=i[0],u=i[1],h=Object(n.useMemo)((function(){return(new c.TextureLoader).load("grasslight-big.jpg")}),[]),d=Object(n.useMemo)((function(){if(e.playground)return e.playground.setPlayers=function(e){return u(e)},e.playground;var t=new f(a,(function(e){return u(e)}));return e.playground=t,t}),[]);return r.a.createElement(p.a,{style:{backgroundColor:"#123"},gl:{antialias:!1,alpha:!0},pixelRatio:window.devicePixelRatio,camera:{position:[0,150,1300],near:1,far:4e3},shadowMap:!0,onCreated:function(e){var t=e.gl;t.toneMapping=c.ReinhardToneMapping,t.outputEncoding=c.sRGBEncoding,t.shadowMap.enabled=!0,t.shadowMap.type=c.PCFSoftShadowMap}},r.a.createElement(I,null),r.a.createElement("fog",{attach:"fog",args:[1122867,1e3,4e3]}),r.a.createElement("ambientLight",{args:[2236962]}),r.a.createElement("directionalLight",{args:[16777215,2.5],position:[250,450,500],"shadow-camera-left":-1e3,"shadow-camera-bottom":-1e3,"shadow-camera-right":1e3,"shadow-camera-top":1e3,"shadow-camera-near":1,"shadow-camera-far":1200,"shadow-mapSize-width":1024,"shadow-mapSize-height":1024,castShadow:!0}),d&&l.map((function(e){return r.a.createElement(M,{key:e.id,player:e})})),r.a.createElement("mesh",{receiveShadow:!0,"rotation-x":-Math.PI/2},r.a.createElement("planeBufferGeometry",{attach:"geometry",args:[16e3,16e3]}),r.a.createElement("meshLambertMaterial",{attach:"material",color:4478310},r.a.createElement("primitive",{attach:"map",object:h,repeat:[64,64],wrapS:c.RepeatWrapping,wrapT:c.RepeatWrapping,encoding:c.sRGBEncoding}))))},x=(a(180),a(212)),B=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,null,[{key:"generatePlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S.randString(5);return{name:e,id:""+Math.round(1e4*Math.random()),position:new c.Vector3(S.rand(-250,250),0,S.rand(-250,250))}}}]),e}();var R=function(e){var t=e.logIn,a=Object(n.useState)(""),o=Object(s.a)(a,2),i=o[0],c=o[1];return r.a.createElement("div",{className:"login-container bp3-light"},r.a.createElement(x.b,{label:"Choose a name to use:"},r.a.createElement(x.c,{placeholder:"name...",large:!0,onChange:function(e){var t=e.target.value||"";c(t)}})),r.a.createElement(x.a,{onClick:function(){t(B.generatePlayer(i))}},"Join"))};a(207);var T=function(){var e=Object(n.useState)(!1),t=Object(s.a)(e,2),a=t[0],o=t[1],i=Object(n.useState)(null),c=Object(s.a)(i,2),l=c[0],u=c[1],p=function(e){u(e),o(!0)};return Object(n.useEffect)((function(){p(B.generatePlayer())}),[]),r.a.createElement("div",{className:"App bp3-dark"},l&&r.a.createElement(P,{player:l}),r.a.createElement("div",{className:"overlay"},!a&&r.a.createElement(R,{logIn:p})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[136,1,2]]]);
//# sourceMappingURL=main.5b01af29.chunk.js.map